import{r as d,j as l,b as A}from"./chunk-JMJ3UQ3L-CakUOnqu.js";import{s as P,r as B,w as V,B as we,u as ye,d as ne,e as C,f as te,g as Re,h as j,P as k,i as F}from"./CommonDialog-EJvDp-ao.js";const Pe=0,$=(e=new Date().toISOString(),t=Pe)=>({enabled:!0,volume:t,updatedAt:e}),Ee=async(e=P.bgm,t)=>{const n=B(e,null);if(!n){const o=$(new Date().toISOString(),t);return V(e,o),o}return n},G=async(e,t=P.bgm)=>{V(t,e)},U=e=>e instanceof Error?e.message:"unknown-error",st=(e={})=>{const[t,n]=d.useState(()=>$()),[o,a]=d.useState(!1),[c,s]=d.useState(null),i=e.storageKey??P.bgm,f=e.defaultVolume;d.useEffect(()=>{let r=!0;return Ee(i,f).then(u=>{if(r){if(e.resetOnLoad&&u.volume!==0){const x={...u,enabled:!1,volume:0,updatedAt:new Date().toISOString()};n(x),G(x,i),a(!0);return}n(u),a(!0)}}).catch(u=>{r&&(n($(new Date().toISOString(),f)),a(!0),s(U(u)))}),()=>{r=!1}},[f,e.resetOnLoad,i]);const h=d.useCallback(async()=>{const r={...t,enabled:!t.enabled,updatedAt:new Date().toISOString()};n(r);try{await G(r,i),s(null)}catch(u){n(t),s(U(u))}},[t,i]),m=d.useCallback(async r=>{const u=r>0,x={...t,enabled:u,volume:r,updatedAt:new Date().toISOString()};n(x);try{await G(x,i),s(null)}catch(w){n(t),s(U(w))}},[t,i]);return{preference:t,isReady:o,toggle:h,setVolume:m,error:c}},Me=.4,Ce=e=>({currentNumber:null,drawHistory:[],isDrawing:!1,createdAt:e,updatedAt:e}),De=e=>({enabled:!0,volume:Me,updatedAt:e}),Ie=()=>B(P.gameState,null),q=()=>B(P.prizes,[]),oe=e=>B(P.bgm,null)??De(e),Ae=e=>e.map(t=>({...t,selected:!1})),it=async(e={})=>{const t=new Date().toISOString(),n=e.resetPrizes??!0,o=q(),a=n?Ae(o):[...o],c=Ce(t),s=oe(t);return await _e({gameState:c,prizes:a,bgm:s}),{gameState:c,prizes:a,bgm:s}},at=async()=>{const e=Ie();if(!e)return null;const t=new Date().toISOString(),n=q(),o=oe(t);return{gameState:e,prizes:n,bgm:o}},_e=async e=>{V(P.gameState,e.gameState),V(P.prizes,e.prizes),V(P.bgm,e.bgm)},ct=()=>{const e=B(P.gameState,null);return e?e.drawHistory.length>0:!1},lt=()=>q().some(t=>t.selected),dt=()=>B(P.gameState,null)!==null,je=({enabled:e,onToggle:t,disabled:n=!1})=>{const o=e?"BGM をオフにする":"BGM をオンにする";return l.jsx(we,{type:"button",className:"rounded-full border border-border bg-background/80 p-2 text-foreground shadow-sm hover:bg-muted focus:outline-none","aria-pressed":e,"aria-label":o,onClick:t,disabled:n,children:l.jsxs("svg",{viewBox:"0 0 24 24",className:"h-6 w-6","aria-hidden":"true",children:[l.jsx("path",{d:"M3 9v6h4l5 5V4L7 9zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02ZM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77",fill:"currentColor"}),e?null:l.jsx("line",{x1:"4",y1:"4",x2:"20",y2:"20",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]})})};function re(e,[t,n]){return Math.min(n,Math.max(t,e))}var Be=d.createContext(void 0);function Ne(e){const t=d.useContext(Be);return e||t||"ltr"}function ze(e){const t=d.useRef({value:e,previous:e});return d.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}function Oe(e){const[t,n]=d.useState(void 0);return ye(()=>{if(e){n({width:e.offsetWidth,height:e.offsetHeight});const o=new ResizeObserver(a=>{if(!Array.isArray(a)||!a.length)return;const c=a[0];let s,i;if("borderBoxSize"in c){const f=c.borderBoxSize,h=Array.isArray(f)?f[0]:f;s=h.inlineSize,i=h.blockSize}else s=e.offsetWidth,i=e.offsetHeight;n({width:s,height:i})});return o.observe(e,{box:"border-box"}),()=>o.unobserve(e)}else n(void 0)},[e]),t}function Te(e){const t=e+"CollectionProvider",[n,o]=ne(t),[a,c]=n(t,{collectionRef:{current:null},itemMap:new Map}),s=v=>{const{scope:S,children:g}=v,y=A.useRef(null),b=A.useRef(new Map).current;return l.jsx(a,{scope:S,itemMap:b,collectionRef:y,children:g})};s.displayName=t;const i=e+"CollectionSlot",f=te(i),h=A.forwardRef((v,S)=>{const{scope:g,children:y}=v,b=c(i,g),p=C(S,b.collectionRef);return l.jsx(f,{ref:p,children:y})});h.displayName=i;const m=e+"CollectionItemSlot",r="data-radix-collection-item",u=te(m),x=A.forwardRef((v,S)=>{const{scope:g,children:y,...b}=v,p=A.useRef(null),E=C(S,p),M=c(m,g);return A.useEffect(()=>(M.itemMap.set(p,{ref:p,...b}),()=>{M.itemMap.delete(p)})),l.jsx(u,{[r]:"",ref:E,children:y})});x.displayName=m;function w(v){const S=c(e+"CollectionConsumer",v);return A.useCallback(()=>{const y=S.collectionRef.current;if(!y)return[];const b=Array.from(y.querySelectorAll(`[${r}]`));return Array.from(S.itemMap.values()).sort((M,z)=>b.indexOf(M.ref.current)-b.indexOf(z.ref.current))},[S.collectionRef,S.itemMap])}return[{Provider:s,Slot:h,ItemSlot:x},w,o]}var se=["PageUp","PageDown"],ie=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],ae={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},N="Slider",[Y,Ve,ke]=Te(N),[ce]=ne(N,[ke]),[Ke,K]=ce(N),le=d.forwardRef((e,t)=>{const{name:n,min:o=0,max:a=100,step:c=1,orientation:s="horizontal",disabled:i=!1,minStepsBetweenThumbs:f=0,defaultValue:h=[o],value:m,onValueChange:r=()=>{},onValueCommit:u=()=>{},inverted:x=!1,form:w,...v}=e,S=d.useRef(new Set),g=d.useRef(0),b=s==="horizontal"?Le:He,[p=[],E]=Re({prop:m,defaultProp:h,onChange:R=>{[...S.current][g.current]?.focus(),r(R)}}),M=d.useRef(p);function z(R){const D=Ye(p,R);O(R,D)}function ve(R){O(R,g.current)}function be(){const R=M.current[g.current];p[g.current]!==R&&u(p)}function O(R,D,{commit:L}={commit:!1}){const Q=qe(c),H=Ze(Math.round((R-o)/c)*c+o,Q),T=re(H,[o,a]);E((_=[])=>{const I=Fe(_,T,D);if(Je(I,f*c)){g.current=I.indexOf(T);const ee=String(I)!==String(_);return ee&&L&&u(I),ee?I:_}else return _})}return l.jsx(Ke,{scope:e.__scopeSlider,name:n,disabled:i,min:o,max:a,valueIndexToChangeRef:g,thumbs:S.current,values:p,orientation:s,form:w,children:l.jsx(Y.Provider,{scope:e.__scopeSlider,children:l.jsx(Y.Slot,{scope:e.__scopeSlider,children:l.jsx(b,{"aria-disabled":i,"data-disabled":i?"":void 0,...v,ref:t,onPointerDown:j(v.onPointerDown,()=>{i||(M.current=p)}),min:o,max:a,inverted:x,onSlideStart:i?void 0:z,onSlideMove:i?void 0:ve,onSlideEnd:i?void 0:be,onHomeKeyDown:()=>!i&&O(o,0,{commit:!0}),onEndKeyDown:()=>!i&&O(a,p.length-1,{commit:!0}),onStepKeyDown:({event:R,direction:D})=>{if(!i){const H=se.includes(R.key)||R.shiftKey&&ie.includes(R.key)?10:1,T=g.current,_=p[T],I=c*H*D;O(_+I,T,{commit:!0})}}})})})})});le.displayName=N;var[de,ue]=ce(N,{startEdge:"left",endEdge:"right",size:"width",direction:1}),Le=d.forwardRef((e,t)=>{const{min:n,max:o,dir:a,inverted:c,onSlideStart:s,onSlideMove:i,onSlideEnd:f,onStepKeyDown:h,...m}=e,[r,u]=d.useState(null),x=C(t,b=>u(b)),w=d.useRef(void 0),v=Ne(a),S=v==="ltr",g=S&&!c||!S&&c;function y(b){const p=w.current||r.getBoundingClientRect(),E=[0,p.width],z=Z(E,g?[n,o]:[o,n]);return w.current=p,z(b-p.left)}return l.jsx(de,{scope:e.__scopeSlider,startEdge:g?"left":"right",endEdge:g?"right":"left",direction:g?1:-1,size:"width",children:l.jsx(fe,{dir:v,"data-orientation":"horizontal",...m,ref:x,style:{...m.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:b=>{const p=y(b.clientX);s?.(p)},onSlideMove:b=>{const p=y(b.clientX);i?.(p)},onSlideEnd:()=>{w.current=void 0,f?.()},onStepKeyDown:b=>{const E=ae[g?"from-left":"from-right"].includes(b.key);h?.({event:b,direction:E?-1:1})}})})}),He=d.forwardRef((e,t)=>{const{min:n,max:o,inverted:a,onSlideStart:c,onSlideMove:s,onSlideEnd:i,onStepKeyDown:f,...h}=e,m=d.useRef(null),r=C(t,m),u=d.useRef(void 0),x=!a;function w(v){const S=u.current||m.current.getBoundingClientRect(),g=[0,S.height],b=Z(g,x?[o,n]:[n,o]);return u.current=S,b(v-S.top)}return l.jsx(de,{scope:e.__scopeSlider,startEdge:x?"bottom":"top",endEdge:x?"top":"bottom",size:"height",direction:x?1:-1,children:l.jsx(fe,{"data-orientation":"vertical",...h,ref:r,style:{...h.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:v=>{const S=w(v.clientY);c?.(S)},onSlideMove:v=>{const S=w(v.clientY);s?.(S)},onSlideEnd:()=>{u.current=void 0,i?.()},onStepKeyDown:v=>{const g=ae[x?"from-bottom":"from-top"].includes(v.key);f?.({event:v,direction:g?-1:1})}})})}),fe=d.forwardRef((e,t)=>{const{__scopeSlider:n,onSlideStart:o,onSlideMove:a,onSlideEnd:c,onHomeKeyDown:s,onEndKeyDown:i,onStepKeyDown:f,...h}=e,m=K(N,n);return l.jsx(k.span,{...h,ref:t,onKeyDown:j(e.onKeyDown,r=>{r.key==="Home"?(s(r),r.preventDefault()):r.key==="End"?(i(r),r.preventDefault()):se.concat(ie).includes(r.key)&&(f(r),r.preventDefault())}),onPointerDown:j(e.onPointerDown,r=>{const u=r.target;u.setPointerCapture(r.pointerId),r.preventDefault(),m.thumbs.has(u)?u.focus():o(r)}),onPointerMove:j(e.onPointerMove,r=>{r.target.hasPointerCapture(r.pointerId)&&a(r)}),onPointerUp:j(e.onPointerUp,r=>{const u=r.target;u.hasPointerCapture(r.pointerId)&&(u.releasePointerCapture(r.pointerId),c(r))})})}),me="SliderTrack",Se=d.forwardRef((e,t)=>{const{__scopeSlider:n,...o}=e,a=K(me,n);return l.jsx(k.span,{"data-disabled":a.disabled?"":void 0,"data-orientation":a.orientation,...o,ref:t})});Se.displayName=me;var W="SliderRange",ge=d.forwardRef((e,t)=>{const{__scopeSlider:n,...o}=e,a=K(W,n),c=ue(W,n),s=d.useRef(null),i=C(t,s),f=a.values.length,h=a.values.map(u=>xe(u,a.min,a.max)),m=f>1?Math.min(...h):0,r=100-Math.max(...h);return l.jsx(k.span,{"data-orientation":a.orientation,"data-disabled":a.disabled?"":void 0,...o,ref:i,style:{...e.style,[c.startEdge]:m+"%",[c.endEdge]:r+"%"}})});ge.displayName=W;var X="SliderThumb",he=d.forwardRef((e,t)=>{const n=Ve(e.__scopeSlider),[o,a]=d.useState(null),c=C(t,i=>a(i)),s=d.useMemo(()=>o?n().findIndex(i=>i.ref.current===o):-1,[n,o]);return l.jsx(Ge,{...e,ref:c,index:s})}),Ge=d.forwardRef((e,t)=>{const{__scopeSlider:n,index:o,name:a,...c}=e,s=K(X,n),i=ue(X,n),[f,h]=d.useState(null),m=C(t,y=>h(y)),r=f?s.form||!!f.closest("form"):!0,u=Oe(f),x=s.values[o],w=x===void 0?0:xe(x,s.min,s.max),v=$e(o,s.values.length),S=u?.[i.size],g=S?We(S,w,i.direction):0;return d.useEffect(()=>{if(f)return s.thumbs.add(f),()=>{s.thumbs.delete(f)}},[f,s.thumbs]),l.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[i.startEdge]:`calc(${w}% + ${g}px)`},children:[l.jsx(Y.ItemSlot,{scope:e.__scopeSlider,children:l.jsx(k.span,{role:"slider","aria-label":e["aria-label"]||v,"aria-valuemin":s.min,"aria-valuenow":x,"aria-valuemax":s.max,"aria-orientation":s.orientation,"data-orientation":s.orientation,"data-disabled":s.disabled?"":void 0,tabIndex:s.disabled?void 0:0,...c,ref:m,style:x===void 0?{display:"none"}:e.style,onFocus:j(e.onFocus,()=>{s.valueIndexToChangeRef.current=o})})}),r&&l.jsx(pe,{name:a??(s.name?s.name+(s.values.length>1?"[]":""):void 0),form:s.form,value:x},o)]})});he.displayName=X;var Ue="RadioBubbleInput",pe=d.forwardRef(({__scopeSlider:e,value:t,...n},o)=>{const a=d.useRef(null),c=C(a,o),s=ze(t);return d.useEffect(()=>{const i=a.current;if(!i)return;const f=window.HTMLInputElement.prototype,m=Object.getOwnPropertyDescriptor(f,"value").set;if(s!==t&&m){const r=new Event("input",{bubbles:!0});m.call(i,t),i.dispatchEvent(r)}},[s,t]),l.jsx(k.input,{style:{display:"none"},...n,ref:c,defaultValue:t})});pe.displayName=Ue;function Fe(e=[],t,n){const o=[...e];return o[n]=t,o.sort((a,c)=>a-c)}function xe(e,t,n){const c=100/(n-t)*(e-t);return re(c,[0,100])}function $e(e,t){return t>2?`Value ${e+1} of ${t}`:t===2?["Minimum","Maximum"][e]:void 0}function Ye(e,t){if(e.length===1)return 0;const n=e.map(a=>Math.abs(a-t)),o=Math.min(...n);return n.indexOf(o)}function We(e,t,n){const o=e/2,c=Z([0,50],[0,o]);return(o-c(t)*n)*n}function Xe(e){return e.slice(0,-1).map((t,n)=>e[n+1]-t)}function Je(e,t){if(t>0){const n=Xe(e);return Math.min(...n)>=t}return!0}function Z(e,t){return n=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const o=(t[1]-t[0])/(e[1]-e[0]);return t[0]+o*(n-e[0])}}function qe(e){return(String(e).split(".")[1]||"").length}function Ze(e,t){const n=Math.pow(10,t);return Math.round(e*n)/n}var Qe=le,et=Se,tt=ge,nt=he;const J=d.forwardRef(({className:e,...t},n)=>l.jsxs(Qe,{ref:n,className:F("relative flex w-full touch-none select-none items-center",t.disabled&&"opacity-50",e),...t,children:[l.jsx(et,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-muted",children:l.jsx(tt,{className:"absolute h-full bg-primary"})}),l.jsx(nt,{className:"block h-5 w-5 rounded-full border border-border bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"})]}));J.displayName="Slider";const ut=({preference:e,isReady:t,onVolumeChange:n,soundPreference:o,onSoundVolumeChange:a,showSoundSlider:c=!0,className:s})=>{const[i,f]=d.useState(!1),h=d.useRef(null);return d.useEffect(()=>{if(!i)return;const m=r=>{const u=r.target;u instanceof Node&&(h.current?.contains(u)||f(!1))};return document.addEventListener("pointerdown",m),()=>{document.removeEventListener("pointerdown",m)}},[i]),l.jsxs("div",{ref:h,className:F("relative flex items-center",s),children:[l.jsx(je,{enabled:e.volume>0,onToggle:()=>f(m=>!m),disabled:!t}),l.jsx("div",{className:F("overflow-hidden transition-[width,opacity,margin] duration-200 ease-out",i?"ml-2 w-52 opacity-100":"ml-0 w-0 opacity-0"),"aria-hidden":!i,children:l.jsxs("div",{className:"flex flex-col gap-2 text-xs",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"w-8 text-right",children:"BGM"}),l.jsx(J,{value:[Math.round(e.volume*100)],min:0,max:100,step:1,disabled:!t,onValueChange:m=>{const r=Math.min(100,Math.max(0,m[0]??0))/100;n(r)}})]}),c&&o&&a?l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"w-8 text-right",children:"SE"}),l.jsx(J,{value:[Math.round(o.volume*100)],min:0,max:100,step:1,disabled:!t,onValueChange:m=>{const r=Math.min(100,Math.max(0,m[0]??0))/100;a(r)}})]}):null]})})]})};export{ut as B,ct as a,lt as b,dt as h,_e as p,at as r,it as s,st as u};
