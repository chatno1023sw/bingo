import{g as In,u as Nn,r as d,k as On,j as m,b as we,w as An}from"./chunk-JMJ3UQ3L-CakUOnqu.js";import{s as wt,b as Ct,u as jn,I as $t,d as Tn,a as Mn,P as Ln}from"./useStoredImage-D6dM61ux.js";import{C as It,B as be,b as Ve,i as rn,X as Pn,S as zn}from"./CommonDialog-EJvDp-ao.js";const St=["id","order","prizeName","itemName","imagePath","selected","memo"],sn=e=>{const t=[];let n="",r=!1;for(let s=0;s<e.length;s+=1){const i=e[s];i==='"'?r&&e[s+1]==='"'?(n+='"',s+=1):r=!r:i===","&&!r?(t.push(n),n=""):n+=i}return t.push(n),t},Fn=e=>sn(e).map(t=>t.trim()),Bn=e=>{const t=e.trim().toLowerCase();return t==="true"||t==="1"||t==="yes"},qt=e=>{const t=e.trim();return t.length===0?null:t},Un=e=>e.length!==St.length?!1:e.every((t,n)=>t===St[n]),$n=e=>{const t=e.split(/\r?\n/).map(u=>u.trim()).filter(u=>u.length>0);if(t.length===0)return{prizes:[],skipped:[]};const n=Fn(t[0]);if(!Un(n))throw new Error("invalid-csv-header");const r=[],s=[],i=new Set;for(const u of t.slice(1)){const h=sn(u).map(q=>q.trim());if(h.length!==n.length){s.push({id:h[0]??"",reason:"column-mismatch"});continue}const[l,p,g,C,x,F,E]=h;if(!l||!g||!C){s.push({id:l??"",reason:"missing-required"});continue}if(i.has(l)){s.push({id:l,reason:"duplicate-id"});continue}const k=Number.parseInt(p,10);if(Number.isNaN(k)){s.push({id:l,reason:"invalid-order"});continue}const B={id:l,order:k,prizeName:g,itemName:C,imagePath:qt(x),selected:Bn(F),memo:qt(E)};r.push(B),i.add(l)}return{prizes:r.sort((u,h)=>u.order-h.order).map((u,h)=>({...u,order:h})),skipped:s}},qn=e=>{if(e==null)return"";const t=/[",\n]/.test(e),n=e.replace(/"/g,'""');return t?`"${n}"`:n},Hn=e=>{const t=St.join(","),n=e.sort((r,s)=>r.order-s.order).map(r=>[r.id,r.order.toString(),r.prizeName,r.itemName,r.imagePath??"",r.selected?"true":"false",r.memo??""].map(s=>qn(s)).join(","));return[t,...n].join(`
`)};var ot={exports:{}};var Wn=ot.exports,Ht;function Kn(){return Ht||(Ht=1,(function(e,t){((n,r)=>{e.exports=r()})(Wn,function n(){var r=typeof self<"u"?self:typeof window<"u"?window:r!==void 0?r:{},s,i=!r.document&&!!r.postMessage,c=r.IS_PAPA_WORKER||!1,u={},h=0,l={};function p(o){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(a){var f=K(a);f.chunkSize=parseInt(f.chunkSize),a.step||a.chunk||(f.chunkSize=null),this._handle=new E(f),(this._handle.streamer=this)._config=f}).call(this,o),this.parseChunk=function(a,f){var v=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<v){let N=this._config.newline;N||(y=this._config.quoteChar||'"',N=this._handle.guessLineEndings(a,y)),a=[...a.split(N).slice(v)].join(N)}this.isFirstChunk&&R(this._config.beforeFirstChunk)&&(y=this._config.beforeFirstChunk(a))!==void 0&&(a=y),this.isFirstChunk=!1,this._halted=!1;var v=this._partialLine+a,y=(this._partialLine="",this._handle.parse(v,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(a=y.meta.cursor,v=(this._finished||(this._partialLine=v.substring(a-this._baseIndex),this._baseIndex=a),y&&y.data&&(this._rowCount+=y.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),c)r.postMessage({results:y,workerId:l.WORKER_ID,finished:v});else if(R(this._config.chunk)&&!f){if(this._config.chunk(y,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=y=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(y.data),this._completeResults.errors=this._completeResults.errors.concat(y.errors),this._completeResults.meta=y.meta),this._completed||!v||!R(this._config.complete)||y&&y.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),v||y&&y.meta.paused||this._nextChunk(),y}this._halted=!0},this._sendError=function(a){R(this._config.error)?this._config.error(a):c&&this._config.error&&r.postMessage({workerId:l.WORKER_ID,error:a,finished:!1})}}function g(o){var a;(o=o||{}).chunkSize||(o.chunkSize=l.RemoteChunkSize),p.call(this,o),this._nextChunk=i?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(f){this._input=f,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(a=new XMLHttpRequest,this._config.withCredentials&&(a.withCredentials=this._config.withCredentials),i||(a.onload=U(this._chunkLoaded,this),a.onerror=U(this._chunkError,this)),a.open(this._config.downloadRequestBody?"POST":"GET",this._input,!i),this._config.downloadRequestHeaders){var f,v=this._config.downloadRequestHeaders;for(f in v)a.setRequestHeader(f,v[f])}var y;this._config.chunkSize&&(y=this._start+this._config.chunkSize-1,a.setRequestHeader("Range","bytes="+this._start+"-"+y));try{a.send(this._config.downloadRequestBody)}catch(N){this._chunkError(N.message)}i&&a.status===0&&this._chunkError()}},this._chunkLoaded=function(){a.readyState===4&&(a.status<200||400<=a.status?this._chunkError():(this._start+=this._config.chunkSize||a.responseText.length,this._finished=!this._config.chunkSize||this._start>=(f=>(f=f.getResponseHeader("Content-Range"))!==null?parseInt(f.substring(f.lastIndexOf("/")+1)):-1)(a),this.parseChunk(a.responseText)))},this._chunkError=function(f){f=a.statusText||f,this._sendError(new Error(f))}}function C(o){(o=o||{}).chunkSize||(o.chunkSize=l.LocalChunkSize),p.call(this,o);var a,f,v=typeof FileReader<"u";this.stream=function(y){this._input=y,f=y.slice||y.webkitSlice||y.mozSlice,v?((a=new FileReader).onload=U(this._chunkLoaded,this),a.onerror=U(this._chunkError,this)):a=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var y=this._input,N=(this._config.chunkSize&&(N=Math.min(this._start+this._config.chunkSize,this._input.size),y=f.call(y,this._start,N)),a.readAsText(y,this._config.encoding));v||this._chunkLoaded({target:{result:N}})},this._chunkLoaded=function(y){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(y.target.result)},this._chunkError=function(){this._sendError(a.error)}}function x(o){var a;p.call(this,o=o||{}),this.stream=function(f){return a=f,this._nextChunk()},this._nextChunk=function(){var f,v;if(!this._finished)return f=this._config.chunkSize,a=f?(v=a.substring(0,f),a.substring(f)):(v=a,""),this._finished=!a,this.parseChunk(v)}}function F(o){p.call(this,o=o||{});var a=[],f=!0,v=!1;this.pause=function(){p.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){p.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(y){this._input=y,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){v&&a.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),a.length?this.parseChunk(a.shift()):f=!0},this._streamData=U(function(y){try{a.push(typeof y=="string"?y:y.toString(this._config.encoding)),f&&(f=!1,this._checkIsFinished(),this.parseChunk(a.shift()))}catch(N){this._streamError(N)}},this),this._streamError=U(function(y){this._streamCleanUp(),this._sendError(y)},this),this._streamEnd=U(function(){this._streamCleanUp(),v=!0,this._streamData("")},this),this._streamCleanUp=U(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function E(o){var a,f,v,y,N=Math.pow(2,53),X=-N,le=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,ue=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,O=this,Z=0,_=0,ie=!1,L=!1,j=[],S={data:[],errors:[],meta:{}};function ee(z){return o.skipEmptyLines==="greedy"?z.join("").trim()==="":z.length===1&&z[0].length===0}function te(){if(S&&v&&(fe("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+l.DefaultDelimiter+"'"),v=!1),o.skipEmptyLines&&(S.data=S.data.filter(function(I){return!ee(I)})),Q()){let I=function(V,ne){R(o.transformHeader)&&(V=o.transformHeader(V,ne)),j.push(V)};if(S)if(Array.isArray(S.data[0])){for(var z=0;Q()&&z<S.data.length;z++)S.data[z].forEach(I);S.data.splice(0,1)}else S.data.forEach(I)}function $(I,V){for(var ne=o.header?{}:[],H=0;H<I.length;H++){var Y=H,b=I[H],b=((T,w)=>(A=>(o.dynamicTypingFunction&&o.dynamicTyping[A]===void 0&&(o.dynamicTyping[A]=o.dynamicTypingFunction(A)),(o.dynamicTyping[A]||o.dynamicTyping)===!0))(T)?w==="true"||w==="TRUE"||w!=="false"&&w!=="FALSE"&&((A=>{if(le.test(A)&&(A=parseFloat(A),X<A&&A<N))return 1})(w)?parseFloat(w):ue.test(w)?new Date(w):w===""?null:w):w)(Y=o.header?H>=j.length?"__parsed_extra":j[H]:Y,b=o.transform?o.transform(b,Y):b);Y==="__parsed_extra"?(ne[Y]=ne[Y]||[],ne[Y].push(b)):ne[Y]=b}return o.header&&(H>j.length?fe("FieldMismatch","TooManyFields","Too many fields: expected "+j.length+" fields but parsed "+H,_+V):H<j.length&&fe("FieldMismatch","TooFewFields","Too few fields: expected "+j.length+" fields but parsed "+H,_+V)),ne}var D;S&&(o.header||o.dynamicTyping||o.transform)&&(D=1,!S.data.length||Array.isArray(S.data[0])?(S.data=S.data.map($),D=S.data.length):S.data=$(S.data,0),o.header&&S.meta&&(S.meta.fields=j),_+=D)}function Q(){return o.header&&j.length===0}function fe(z,$,D,I){z={type:z,code:$,message:D},I!==void 0&&(z.row=I),S.errors.push(z)}R(o.step)&&(y=o.step,o.step=function(z){S=z,Q()?te():(te(),S.data.length!==0&&(Z+=z.data.length,o.preview&&Z>o.preview?f.abort():(S.data=S.data[0],y(S,O))))}),this.parse=function(z,$,D){var I=o.quoteChar||'"',I=(o.newline||(o.newline=this.guessLineEndings(z,I)),v=!1,o.delimiter?R(o.delimiter)&&(o.delimiter=o.delimiter(z),S.meta.delimiter=o.delimiter):((I=((V,ne,H,Y,b)=>{var T,w,A,W;b=b||[",","	","|",";",l.RECORD_SEP,l.UNIT_SEP];for(var ge=0;ge<b.length;ge++){for(var ae,J=b[ge],re=0,de=0,oe=0,se=(A=void 0,new B({comments:Y,delimiter:J,newline:ne,preview:10}).parse(V)),he=0;he<se.data.length;he++)H&&ee(se.data[he])?oe++:(ae=se.data[he].length,de+=ae,A===void 0?A=ae:0<ae&&(re+=Math.abs(ae-A),A=ae));0<se.data.length&&(de/=se.data.length-oe),(w===void 0||re<=w)&&(W===void 0||W<de)&&1.99<de&&(w=re,T=J,W=de)}return{successful:!!(o.delimiter=T),bestDelimiter:T}})(z,o.newline,o.skipEmptyLines,o.comments,o.delimitersToGuess)).successful?o.delimiter=I.bestDelimiter:(v=!0,o.delimiter=l.DefaultDelimiter),S.meta.delimiter=o.delimiter),K(o));return o.preview&&o.header&&I.preview++,a=z,f=new B(I),S=f.parse(a,$,D),te(),ie?{meta:{paused:!0}}:S||{meta:{paused:!1}}},this.paused=function(){return ie},this.pause=function(){ie=!0,f.abort(),a=R(o.chunk)?"":a.substring(f.getCharIndex())},this.resume=function(){O.streamer._halted?(ie=!1,O.streamer.parseChunk(a,!0)):setTimeout(O.resume,3)},this.aborted=function(){return L},this.abort=function(){L=!0,f.abort(),S.meta.aborted=!0,R(o.complete)&&o.complete(S),a=""},this.guessLineEndings=function(V,I){V=V.substring(0,1048576);var I=new RegExp(k(I)+"([^]*?)"+k(I),"gm"),D=(V=V.replace(I,"")).split("\r"),I=V.split(`
`),V=1<I.length&&I[0].length<D[0].length;if(D.length===1||V)return`
`;for(var ne=0,H=0;H<D.length;H++)D[H][0]===`
`&&ne++;return ne>=D.length/2?`\r
`:"\r"}}function k(o){return o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function B(o){var a=(o=o||{}).delimiter,f=o.newline,v=o.comments,y=o.step,N=o.preview,X=o.fastMode,le=null,ue=!1,O=o.quoteChar==null?'"':o.quoteChar,Z=O;if(o.escapeChar!==void 0&&(Z=o.escapeChar),(typeof a!="string"||-1<l.BAD_DELIMITERS.indexOf(a))&&(a=","),v===a)throw new Error("Comment character same as delimiter");v===!0?v="#":(typeof v!="string"||-1<l.BAD_DELIMITERS.indexOf(v))&&(v=!1),f!==`
`&&f!=="\r"&&f!==`\r
`&&(f=`
`);var _=0,ie=!1;this.parse=function(L,j,S){if(typeof L!="string")throw new Error("Input must be a string");var ee=L.length,te=a.length,Q=f.length,fe=v.length,z=R(y),$=[],D=[],I=[],V=_=0;if(!L)return re();if(X||X!==!1&&L.indexOf(O)===-1){for(var ne=L.split(f),H=0;H<ne.length;H++){if(I=ne[H],_+=I.length,H!==ne.length-1)_+=f.length;else if(S)return re();if(!v||I.substring(0,fe)!==v){if(z){if($=[],W(I.split(a)),de(),ie)return re()}else W(I.split(a));if(N&&N<=H)return $=$.slice(0,N),re(!0)}}return re()}for(var Y=L.indexOf(a,_),b=L.indexOf(f,_),T=new RegExp(k(Z)+k(O),"g"),w=L.indexOf(O,_);;)if(L[_]===O)for(w=_,_++;;){if((w=L.indexOf(O,w+1))===-1)return S||D.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:$.length,index:_}),ae();if(w===ee-1)return ae(L.substring(_,w).replace(T,O));if(O===Z&&L[w+1]===Z)w++;else if(O===Z||w===0||L[w-1]!==Z){Y!==-1&&Y<w+1&&(Y=L.indexOf(a,w+1));var A=ge((b=b!==-1&&b<w+1?L.indexOf(f,w+1):b)===-1?Y:Math.min(Y,b));if(L.substr(w+1+A,te)===a){I.push(L.substring(_,w).replace(T,O)),L[_=w+1+A+te]!==O&&(w=L.indexOf(O,_)),Y=L.indexOf(a,_),b=L.indexOf(f,_);break}if(A=ge(b),L.substring(w+1+A,w+1+A+Q)===f){if(I.push(L.substring(_,w).replace(T,O)),J(w+1+A+Q),Y=L.indexOf(a,_),w=L.indexOf(O,_),z&&(de(),ie))return re();if(N&&$.length>=N)return re(!0);break}D.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:$.length,index:_}),w++}}else if(v&&I.length===0&&L.substring(_,_+fe)===v){if(b===-1)return re();_=b+Q,b=L.indexOf(f,_),Y=L.indexOf(a,_)}else if(Y!==-1&&(Y<b||b===-1))I.push(L.substring(_,Y)),_=Y+te,Y=L.indexOf(a,_);else{if(b===-1)break;if(I.push(L.substring(_,b)),J(b+Q),z&&(de(),ie))return re();if(N&&$.length>=N)return re(!0)}return ae();function W(oe){$.push(oe),V=_}function ge(oe){var se=0;return se=oe!==-1&&(oe=L.substring(w+1,oe))&&oe.trim()===""?oe.length:se}function ae(oe){return S||(oe===void 0&&(oe=L.substring(_)),I.push(oe),_=ee,W(I),z&&de()),re()}function J(oe){_=oe,W(I),I=[],b=L.indexOf(f,_)}function re(oe){if(o.header&&!j&&$.length&&!ue){var se=$[0],he=Object.create(null),ce=new Set(se);let ze=!1;for(let ye=0;ye<se.length;ye++){let Se=se[ye];if(he[Se=R(o.transformHeader)?o.transformHeader(Se,ye):Se]){let Fe,st=he[Se];for(;Fe=Se+"_"+st,st++,ce.has(Fe););ce.add(Fe),se[ye]=Fe,he[Se]++,ze=!0,(le=le===null?{}:le)[Fe]=Se}else he[Se]=1,se[ye]=Se;ce.add(Se)}ze&&console.warn("Duplicate headers found and renamed."),ue=!0}return{data:$,errors:D,meta:{delimiter:a,linebreak:f,aborted:ie,truncated:!!oe,cursor:V+(j||0),renamedHeaders:le}}}function de(){y(re()),$=[],D=[]}},this.abort=function(){ie=!0},this.getCharIndex=function(){return _}}function q(o){var a=o.data,f=u[a.workerId],v=!1;if(a.error)f.userError(a.error,a.file);else if(a.results&&a.results.data){var y={abort:function(){v=!0,M(a.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:P,resume:P};if(R(f.userStep)){for(var N=0;N<a.results.data.length&&(f.userStep({data:a.results.data[N],errors:a.results.errors,meta:a.results.meta},y),!v);N++);delete a.results}else R(f.userChunk)&&(f.userChunk(a.results,y,a.file),delete a.results)}a.finished&&!v&&M(a.workerId,a.results)}function M(o,a){var f=u[o];R(f.userComplete)&&f.userComplete(a),f.terminate(),delete u[o]}function P(){throw new Error("Not implemented.")}function K(o){if(typeof o!="object"||o===null)return o;var a,f=Array.isArray(o)?[]:{};for(a in o)f[a]=K(o[a]);return f}function U(o,a){return function(){o.apply(a,arguments)}}function R(o){return typeof o=="function"}return l.parse=function(o,a){var f=(a=a||{}).dynamicTyping||!1;if(R(f)&&(a.dynamicTypingFunction=f,f={}),a.dynamicTyping=f,a.transform=!!R(a.transform)&&a.transform,!a.worker||!l.WORKERS_SUPPORTED)return f=null,l.NODE_STREAM_INPUT,typeof o=="string"?(o=(v=>v.charCodeAt(0)!==65279?v:v.slice(1))(o),f=new(a.download?g:x)(a)):o.readable===!0&&R(o.read)&&R(o.on)?f=new F(a):(r.File&&o instanceof File||o instanceof Object)&&(f=new C(a)),f.stream(o);(f=(()=>{var v;return!!l.WORKERS_SUPPORTED&&(v=(()=>{var y=r.URL||r.webkitURL||null,N=n.toString();return l.BLOB_URL||(l.BLOB_URL=y.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",N,")();"],{type:"text/javascript"})))})(),(v=new r.Worker(v)).onmessage=q,v.id=h++,u[v.id]=v)})()).userStep=a.step,f.userChunk=a.chunk,f.userComplete=a.complete,f.userError=a.error,a.step=R(a.step),a.chunk=R(a.chunk),a.complete=R(a.complete),a.error=R(a.error),delete a.worker,f.postMessage({input:o,config:a,workerId:f.id})},l.unparse=function(o,a){var f=!1,v=!0,y=",",N=`\r
`,X='"',le=X+X,ue=!1,O=null,Z=!1,_=((()=>{if(typeof a=="object"){if(typeof a.delimiter!="string"||l.BAD_DELIMITERS.filter(function(j){return a.delimiter.indexOf(j)!==-1}).length||(y=a.delimiter),typeof a.quotes!="boolean"&&typeof a.quotes!="function"&&!Array.isArray(a.quotes)||(f=a.quotes),typeof a.skipEmptyLines!="boolean"&&typeof a.skipEmptyLines!="string"||(ue=a.skipEmptyLines),typeof a.newline=="string"&&(N=a.newline),typeof a.quoteChar=="string"&&(X=a.quoteChar),typeof a.header=="boolean"&&(v=a.header),Array.isArray(a.columns)){if(a.columns.length===0)throw new Error("Option columns is empty");O=a.columns}a.escapeChar!==void 0&&(le=a.escapeChar+X),a.escapeFormulae instanceof RegExp?Z=a.escapeFormulae:typeof a.escapeFormulae=="boolean"&&a.escapeFormulae&&(Z=/^[=+\-@\t\r].*$/)}})(),new RegExp(k(X),"g"));if(typeof o=="string"&&(o=JSON.parse(o)),Array.isArray(o)){if(!o.length||Array.isArray(o[0]))return ie(null,o,ue);if(typeof o[0]=="object")return ie(O||Object.keys(o[0]),o,ue)}else if(typeof o=="object")return typeof o.data=="string"&&(o.data=JSON.parse(o.data)),Array.isArray(o.data)&&(o.fields||(o.fields=o.meta&&o.meta.fields||O),o.fields||(o.fields=Array.isArray(o.data[0])?o.fields:typeof o.data[0]=="object"?Object.keys(o.data[0]):[]),Array.isArray(o.data[0])||typeof o.data[0]=="object"||(o.data=[o.data])),ie(o.fields||[],o.data||[],ue);throw new Error("Unable to serialize unrecognized input");function ie(j,S,ee){var te="",Q=(typeof j=="string"&&(j=JSON.parse(j)),typeof S=="string"&&(S=JSON.parse(S)),Array.isArray(j)&&0<j.length),fe=!Array.isArray(S[0]);if(Q&&v){for(var z=0;z<j.length;z++)0<z&&(te+=y),te+=L(j[z],z);0<S.length&&(te+=N)}for(var $=0;$<S.length;$++){var D=(Q?j:S[$]).length,I=!1,V=Q?Object.keys(S[$]).length===0:S[$].length===0;if(ee&&!Q&&(I=ee==="greedy"?S[$].join("").trim()==="":S[$].length===1&&S[$][0].length===0),ee==="greedy"&&Q){for(var ne=[],H=0;H<D;H++){var Y=fe?j[H]:H;ne.push(S[$][Y])}I=ne.join("").trim()===""}if(!I){for(var b=0;b<D;b++){0<b&&!V&&(te+=y);var T=Q&&fe?j[b]:b;te+=L(S[$][T],b)}$<S.length-1&&(!ee||0<D&&!V)&&(te+=N)}}return te}function L(j,S){var ee,te;return j==null?"":j.constructor===Date?JSON.stringify(j).slice(1,25):(te=!1,Z&&typeof j=="string"&&Z.test(j)&&(j="'"+j,te=!0),ee=j.toString().replace(_,le),(te=te||f===!0||typeof f=="function"&&f(j,S)||Array.isArray(f)&&f[S]||((Q,fe)=>{for(var z=0;z<fe.length;z++)if(-1<Q.indexOf(fe[z]))return!0;return!1})(ee,l.BAD_DELIMITERS)||-1<ee.indexOf(y)||ee.charAt(0)===" "||ee.charAt(ee.length-1)===" ")?X+ee+X:ee)}},l.RECORD_SEP="",l.UNIT_SEP="",l.BYTE_ORDER_MARK="\uFEFF",l.BAD_DELIMITERS=["\r",`
`,'"',l.BYTE_ORDER_MARK],l.WORKERS_SUPPORTED=!i&&!!r.Worker,l.NODE_STREAM_INPUT=1,l.LocalChunkSize=10485760,l.RemoteChunkSize=5242880,l.DefaultDelimiter=",",l.Parser=B,l.ParserHandle=E,l.NetworkStreamer=g,l.FileStreamer=C,l.StringStreamer=x,l.ReadableStreamStreamer=F,r.jQuery&&((s=r.jQuery).fn.parse=function(o){var a=o.config||{},f=[];return this.each(function(N){if(!(s(this).prop("tagName").toUpperCase()==="INPUT"&&s(this).attr("type").toLowerCase()==="file"&&r.FileReader)||!this.files||this.files.length===0)return!0;for(var X=0;X<this.files.length;X++)f.push({file:this.files[X],inputElem:this,instanceConfig:s.extend({},a)})}),v(),this;function v(){if(f.length===0)R(o.complete)&&o.complete();else{var N,X,le,ue,O=f[0];if(R(o.before)){var Z=o.before(O.file,O.inputElem);if(typeof Z=="object"){if(Z.action==="abort")return N="AbortError",X=O.file,le=O.inputElem,ue=Z.reason,void(R(o.error)&&o.error({name:N},X,le,ue));if(Z.action==="skip")return void y();typeof Z.config=="object"&&(O.instanceConfig=s.extend(O.instanceConfig,Z.config))}else if(Z==="skip")return void y()}var _=O.instanceConfig.complete;O.instanceConfig.complete=function(ie){R(_)&&_(ie,O.file,O.inputElem),y()},l.parse(O.file,O.instanceConfig)}}function y(){f.splice(0,1),v()}}),c&&(r.onmessage=function(o){o=o.data,l.WORKER_ID===void 0&&o&&(l.WORKER_ID=o.workerId),typeof o.input=="string"?r.postMessage({workerId:l.WORKER_ID,results:l.parse(o.input,o.config),finished:!0}):(r.File&&o.input instanceof File||o.input instanceof Object)&&(o=l.parse(o.input,o.config))&&r.postMessage({workerId:l.WORKER_ID,results:o,finished:!0})}),(g.prototype=Object.create(p.prototype)).constructor=g,(C.prototype=Object.create(p.prototype)).constructor=C,(x.prototype=Object.create(x.prototype)).constructor=x,(F.prototype=Object.create(p.prototype)).constructor=F,l})})(ot)),ot.exports}var Xn=Kn();const Vn=In(Xn),Yn=({prizes:e,isLoading:t,error:n,applyPrizes:r})=>{const s=Nn(),[i,c]=d.useState(null),[u,h]=d.useState(null),[l,p]=d.useState(null),[g,C]=d.useState(`id,order,prizeName,itemName,imagePath,selected,memo
`),[x,F]=d.useState(!1),[E,k]=d.useState(!1),[B,q]=d.useState(!1),[M,P]=d.useState([]),[K,U]=d.useState(!1),[R,o]=d.useState(!1),[a,f]=d.useState(!1),v=d.useRef(!1),y=(b,T)=>({sourceName:b,addedCount:T.prizes.length,skipped:T.skipped,processedAt:new Date().toISOString()}),N=async(b,T)=>{try{const w=$n(b);P(w.prizes),c(y(T,w)),p(null)}catch(w){const A=w instanceof Error?w.message:"csv-import-error";p(A)}},X=async b=>{const T=await b.text();await N(T,b.name)},le=async()=>{await N(g,"manual-input")},ue=()=>{const b=Hn(M);h(b)},O=()=>{const b=document.getElementById("csv-import-simple");b instanceof HTMLInputElement&&b.click()},Z=()=>{const b=document.getElementById("image-import-simple");b instanceof HTMLInputElement&&b.click()},_=b=>{if(!b)return!1;const T=b.trim().toLowerCase();return T==="true"||T==="1"||T==="yes"||T==="selected"||b.trim()==="選出"},ie=async b=>{const T=await b.text(),w=Vn.parse(T,{header:!0,skipEmptyLines:!0});if(w.errors.length>0){p("csv-import-error");return}const A=w.data.map((W,ge)=>({id:globalThis.crypto?.randomUUID?.()??`prize-${Date.now()}-${Math.random().toString(16).slice(2)}-${ge}`,order:M.length+ge,prizeName:W.賞名?.trim()??"",itemName:W.賞品名?.trim()??"",imagePath:null,selected:_(W.選出),memo:null})).filter(W=>W.prizeName||W.itemName);if(A.length===0){p("csv-import-empty");return}P(W=>[...W,...A]),p(null)},L=()=>{P([]),c(null),F(!1)},j=()=>{P(b=>b.map((T,w)=>({...T,selected:!1,order:w}))),k(!1)},S=async b=>{if(b.length!==0){q(!0);try{const T=Array.from(b).filter(J=>J.type.startsWith("image/")).map(J=>({name:J.name,file:J})),w=J=>J.trim().toLowerCase().replace(/\.[^/.]+$/,""),A=T.reduce((J,re)=>{const de=w(re.name);return de&&(J[de]=J[de]?[...J[de],re]:[re]),J},{}),W=Object.keys(A),ge=T.slice(),ae=[];for(const J of M){const re=[J.itemName,J.prizeName].map(ce=>w(ce)).filter(ce=>ce.length>0),de=re.find(ce=>A[ce]?.length)??W.find(ce=>re.some(ze=>ce.includes(ze)));if(!de&&re.length===0){const ce=ge.shift();if(!ce){ae.push(J);continue}await wt(J.id,ce.file),ae.push({...J,imagePath:Ct(J.id)});continue}if(!de){ae.push(J);continue}const oe=A[de];if(!oe||oe.length===0){ae.push(J);continue}const se=oe.shift();if(!se){ae.push(J);continue}const he=ge.findIndex(ce=>ce.name===se.name);he>=0&&ge.splice(he,1),await wt(J.id,se.file),ae.push({...J,imagePath:Ct(J.id)})}P(ae),p(null)}catch(T){const w=T instanceof Error?T.message:"image-upload-error";p(w)}finally{q(!1)}}},ee=b=>({id:globalThis.crypto?.randomUUID?.()??`prize-${Date.now()}-${Math.random().toString(16).slice(2)}`,order:b,prizeName:"",itemName:"",imagePath:null,selected:!1,memo:null}),te=()=>{P(b=>[...b,ee(b.length)])},Q=b=>{P(T=>T.filter(w=>w.id!==b).map((w,A)=>({...w,order:A})))},fe=(b,T)=>{P(w=>w.map(A=>A.id===b?{...A,...T}:A))},z=b=>{const T=new Map(M.map(A=>[A.id,A])),w=b.map(A=>T.get(A)).filter(A=>!!A).map((A,W)=>({...A,order:W}));P(w)},D=!((b,T)=>b.length!==T.length?!1:b.every((w,A)=>{const W=T[A];return w.id===W.id&&w.order===W.order&&w.prizeName===W.prizeName&&w.itemName===W.itemName&&w.imagePath===W.imagePath&&w.selected===W.selected&&w.memo===W.memo}))(M,e);d.useEffect(()=>{if(!v.current&&!t){P(e),v.current=!0;return}D||P(e)},[D,t,e]);const I=On(D&&!a);return d.useEffect(()=>{I.state==="blocked"&&U(!0)},[I.state]),d.useEffect(()=>{if(!D)return;const b=T=>{T.preventDefault(),T.returnValue=""};return window.addEventListener("beforeunload",b),()=>{window.removeEventListener("beforeunload",b)}},[D]),{draftPrizes:M,summary:i,exportText:u,localError:l,manualCsv:g,deleteOpen:x,resetOpen:E,confirmOpen:K,isSaving:R,isUploading:B,isDirty:D,combinedError:n??l,setManualCsv:C,setDeleteOpen:F,setResetOpen:k,handleAddCard:te,handleCsvImportClick:O,handleImageUploadClick:Z,handleFileImport:X,handleManualImport:le,handleExport:ue,handleCsvImport:ie,handleUploadImages:S,handleDeleteAll:L,handleResetSelections:j,handleReorder:z,handleRemove:Q,handleUpdate:fe,handleSaveAndBack:async()=>{o(!0);try{if(f(!0),!D){s("/start");return}await r(M),s("/start")}finally{o(!1),f(!1)}},handleCancelConfirm:()=>{U(!1),f(!1),I.reset?.()},handleConfirmProceed:()=>{U(!1),f(!0),I.proceed?.()}}},Jn=({open:e,title:t="本当にすべて削除する？",description:n="新しく景品を登録するときにオススメ！",onClose:r,onConfirm:s,disabled:i=!1})=>m.jsx(It,{open:e,onClose:r,title:t,description:n,showCloseButton:!0,closeDisabled:i,footer:m.jsxs(m.Fragment,{children:[m.jsx(be,{type:"button",variant:"outline",className:"flex-1 rounded-2xl px-4 py-3",onClick:r,disabled:i,children:"キャンセル"}),m.jsx(be,{type:"button",variant:"destructive",className:"flex-1 rounded-2xl px-4 py-3",onClick:s,disabled:i,children:"削除"})]})});function Qn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return d.useMemo(()=>r=>{t.forEach(s=>s(r))},t)}const ft=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function $e(e){const t=Object.prototype.toString.call(e);return t==="[object Window]"||t==="[object global]"}function Nt(e){return"nodeType"in e}function Ce(e){var t,n;return e?$e(e)?e:Nt(e)&&(t=(n=e.ownerDocument)==null?void 0:n.defaultView)!=null?t:window:window}function Ot(e){const{Document:t}=Ce(e);return e instanceof t}function tt(e){return $e(e)?!1:e instanceof Ce(e).HTMLElement}function on(e){return e instanceof Ce(e).SVGElement}function qe(e){return e?$e(e)?e.document:Nt(e)?Ot(e)?e:tt(e)||on(e)?e.ownerDocument:document:document:document}const Ae=ft?d.useLayoutEffect:d.useEffect;function At(e){const t=d.useRef(e);return Ae(()=>{t.current=e}),d.useCallback(function(){for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return t.current==null?void 0:t.current(...r)},[])}function Gn(){const e=d.useRef(null),t=d.useCallback((r,s)=>{e.current=setInterval(r,s)},[]),n=d.useCallback(()=>{e.current!==null&&(clearInterval(e.current),e.current=null)},[]);return[t,n]}function Ge(e,t){t===void 0&&(t=[e]);const n=d.useRef(e);return Ae(()=>{n.current!==e&&(n.current=e)},t),n}function nt(e,t){const n=d.useRef();return d.useMemo(()=>{const r=e(n.current);return n.current=r,r},[...t])}function lt(e){const t=At(e),n=d.useRef(null),r=d.useCallback(s=>{s!==n.current&&t?.(s,n.current),n.current=s},[]);return[n,r]}function Rt(e){const t=d.useRef();return d.useEffect(()=>{t.current=e},[e]),t.current}let vt={};function rt(e,t){return d.useMemo(()=>{if(t)return t;const n=vt[e]==null?0:vt[e]+1;return vt[e]=n,e+"-"+n},[e,t])}function an(e){return function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];return r.reduce((i,c)=>{const u=Object.entries(c);for(const[h,l]of u){const p=i[h];p!=null&&(i[h]=p+e*l)}return i},{...t})}}const Ue=an(1),ct=an(-1);function Zn(e){return"clientX"in e&&"clientY"in e}function jt(e){if(!e)return!1;const{KeyboardEvent:t}=Ce(e.target);return t&&e instanceof t}function er(e){if(!e)return!1;const{TouchEvent:t}=Ce(e.target);return t&&e instanceof t}function Et(e){if(er(e)){if(e.touches&&e.touches.length){const{clientX:t,clientY:n}=e.touches[0];return{x:t,y:n}}else if(e.changedTouches&&e.changedTouches.length){const{clientX:t,clientY:n}=e.changedTouches[0];return{x:t,y:n}}}return Zn(e)?{x:e.clientX,y:e.clientY}:null}const Ze=Object.freeze({Translate:{toString(e){if(!e)return;const{x:t,y:n}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:t,scaleY:n}=e;return"scaleX("+t+") scaleY("+n+")"}},Transform:{toString(e){if(e)return[Ze.Translate.toString(e),Ze.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:n,easing:r}=e;return t+" "+n+"ms "+r}}}),Wt="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function tr(e){return e.matches(Wt)?e:e.querySelector(Wt)}const nr={display:"none"};function rr(e){let{id:t,value:n}=e;return we.createElement("div",{id:t,style:nr},n)}function sr(e){let{id:t,announcement:n,ariaLiveType:r="assertive"}=e;const s={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return we.createElement("div",{id:t,style:s,role:"status","aria-live":r,"aria-atomic":!0},n)}function ir(){const[e,t]=d.useState("");return{announce:d.useCallback(r=>{r!=null&&t(r)},[]),announcement:e}}const ln=d.createContext(null);function or(e){const t=d.useContext(ln);d.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(e)},[e,t])}function ar(){const[e]=d.useState(()=>new Set),t=d.useCallback(r=>(e.add(r),()=>e.delete(r)),[e]);return[d.useCallback(r=>{let{type:s,event:i}=r;e.forEach(c=>{var u;return(u=c[s])==null?void 0:u.call(c,i)})},[e]),t]}const lr={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},cr={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was moved over droppable area "+n.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was dropped over droppable area "+n.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function ur(e){let{announcements:t=cr,container:n,hiddenTextDescribedById:r,screenReaderInstructions:s=lr}=e;const{announce:i,announcement:c}=ir(),u=rt("DndLiveRegion"),[h,l]=d.useState(!1);if(d.useEffect(()=>{l(!0)},[]),or(d.useMemo(()=>({onDragStart(g){let{active:C}=g;i(t.onDragStart({active:C}))},onDragMove(g){let{active:C,over:x}=g;t.onDragMove&&i(t.onDragMove({active:C,over:x}))},onDragOver(g){let{active:C,over:x}=g;i(t.onDragOver({active:C,over:x}))},onDragEnd(g){let{active:C,over:x}=g;i(t.onDragEnd({active:C,over:x}))},onDragCancel(g){let{active:C,over:x}=g;i(t.onDragCancel({active:C,over:x}))}}),[i,t])),!h)return null;const p=we.createElement(we.Fragment,null,we.createElement(rr,{id:r,value:s.draggable}),we.createElement(sr,{id:u,announcement:c}));return n?Ve.createPortal(p,n):p}var pe;(function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"})(pe||(pe={}));function ut(){}function dr(e,t){return d.useMemo(()=>({sensor:e,options:t??{}}),[e,t])}function fr(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return d.useMemo(()=>[...t].filter(r=>r!=null),[...t])}const Ie=Object.freeze({x:0,y:0});function hr(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function pr(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return n-r}function gr(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return r-n}function mr(e,t){if(!e||e.length===0)return null;const[n]=e;return n[t]}function Kt(e,t,n){return t===void 0&&(t=e.left),n===void 0&&(n=e.top),{x:t+e.width*.5,y:n+e.height*.5}}const vr=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const s=Kt(t,t.left,t.top),i=[];for(const c of r){const{id:u}=c,h=n.get(u);if(h){const l=hr(Kt(h),s);i.push({id:u,data:{droppableContainer:c,value:l}})}}return i.sort(pr)};function br(e,t){const n=Math.max(t.top,e.top),r=Math.max(t.left,e.left),s=Math.min(t.left+t.width,e.left+e.width),i=Math.min(t.top+t.height,e.top+e.height),c=s-r,u=i-n;if(r<s&&n<i){const h=t.width*t.height,l=e.width*e.height,p=c*u,g=p/(h+l-p);return Number(g.toFixed(4))}return 0}const xr=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const s=[];for(const i of r){const{id:c}=i,u=n.get(c);if(u){const h=br(u,t);h>0&&s.push({id:c,data:{droppableContainer:i,value:h}})}}return s.sort(gr)};function yr(e,t,n){return{...e,scaleX:t&&n?t.width/n.width:1,scaleY:t&&n?t.height/n.height:1}}function cn(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:Ie}function wr(e){return function(n){for(var r=arguments.length,s=new Array(r>1?r-1:0),i=1;i<r;i++)s[i-1]=arguments[i];return s.reduce((c,u)=>({...c,top:c.top+e*u.y,bottom:c.bottom+e*u.y,left:c.left+e*u.x,right:c.right+e*u.x}),{...n})}}const Cr=wr(1);function Sr(e){if(e.startsWith("matrix3d(")){const t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}else if(e.startsWith("matrix(")){const t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function Rr(e,t,n){const r=Sr(t);if(!r)return e;const{scaleX:s,scaleY:i,x:c,y:u}=r,h=e.left-c-(1-s)*parseFloat(n),l=e.top-u-(1-i)*parseFloat(n.slice(n.indexOf(" ")+1)),p=s?e.width/s:e.width,g=i?e.height/i:e.height;return{width:p,height:g,top:l,right:h+p,bottom:l+g,left:h}}const Er={ignoreTransform:!1};function He(e,t){t===void 0&&(t=Er);let n=e.getBoundingClientRect();if(t.ignoreTransform){const{transform:l,transformOrigin:p}=Ce(e).getComputedStyle(e);l&&(n=Rr(n,l,p))}const{top:r,left:s,width:i,height:c,bottom:u,right:h}=n;return{top:r,left:s,width:i,height:c,bottom:u,right:h}}function Xt(e){return He(e,{ignoreTransform:!0})}function Dr(e){const t=e.innerWidth,n=e.innerHeight;return{top:0,left:0,right:t,bottom:n,width:t,height:n}}function kr(e,t){return t===void 0&&(t=Ce(e).getComputedStyle(e)),t.position==="fixed"}function _r(e,t){t===void 0&&(t=Ce(e).getComputedStyle(e));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(s=>{const i=t[s];return typeof i=="string"?n.test(i):!1})}function Tt(e,t){const n=[];function r(s){if(t!=null&&n.length>=t||!s)return n;if(Ot(s)&&s.scrollingElement!=null&&!n.includes(s.scrollingElement))return n.push(s.scrollingElement),n;if(!tt(s)||on(s)||n.includes(s))return n;const i=Ce(e).getComputedStyle(s);return s!==e&&_r(s,i)&&n.push(s),kr(s,i)?n:r(s.parentNode)}return e?r(e):n}function un(e){const[t]=Tt(e,1);return t??null}function bt(e){return!ft||!e?null:$e(e)?e:Nt(e)?Ot(e)||e===qe(e).scrollingElement?window:tt(e)?e:null:null}function dn(e){return $e(e)?e.scrollX:e.scrollLeft}function fn(e){return $e(e)?e.scrollY:e.scrollTop}function Dt(e){return{x:dn(e),y:fn(e)}}var me;(function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"})(me||(me={}));function hn(e){return!ft||!e?!1:e===document.scrollingElement}function pn(e){const t={x:0,y:0},n=hn(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},r={x:e.scrollWidth-n.width,y:e.scrollHeight-n.height},s=e.scrollTop<=t.y,i=e.scrollLeft<=t.x,c=e.scrollTop>=r.y,u=e.scrollLeft>=r.x;return{isTop:s,isLeft:i,isBottom:c,isRight:u,maxScroll:r,minScroll:t}}const Ir={x:.2,y:.2};function Nr(e,t,n,r,s){let{top:i,left:c,right:u,bottom:h}=n;r===void 0&&(r=10),s===void 0&&(s=Ir);const{isTop:l,isBottom:p,isLeft:g,isRight:C}=pn(e),x={x:0,y:0},F={x:0,y:0},E={height:t.height*s.y,width:t.width*s.x};return!l&&i<=t.top+E.height?(x.y=me.Backward,F.y=r*Math.abs((t.top+E.height-i)/E.height)):!p&&h>=t.bottom-E.height&&(x.y=me.Forward,F.y=r*Math.abs((t.bottom-E.height-h)/E.height)),!C&&u>=t.right-E.width?(x.x=me.Forward,F.x=r*Math.abs((t.right-E.width-u)/E.width)):!g&&c<=t.left+E.width&&(x.x=me.Backward,F.x=r*Math.abs((t.left+E.width-c)/E.width)),{direction:x,speed:F}}function Or(e){if(e===document.scrollingElement){const{innerWidth:i,innerHeight:c}=window;return{top:0,left:0,right:i,bottom:c,width:i,height:c}}const{top:t,left:n,right:r,bottom:s}=e.getBoundingClientRect();return{top:t,left:n,right:r,bottom:s,width:e.clientWidth,height:e.clientHeight}}function gn(e){return e.reduce((t,n)=>Ue(t,Dt(n)),Ie)}function Ar(e){return e.reduce((t,n)=>t+dn(n),0)}function jr(e){return e.reduce((t,n)=>t+fn(n),0)}function Tr(e,t){if(t===void 0&&(t=He),!e)return;const{top:n,left:r,bottom:s,right:i}=t(e);un(e)&&(s<=0||i<=0||n>=window.innerHeight||r>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const Mr=[["x",["left","right"],Ar],["y",["top","bottom"],jr]];class Mt{constructor(t,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const r=Tt(n),s=gn(r);this.rect={...t},this.width=t.width,this.height=t.height;for(const[i,c,u]of Mr)for(const h of c)Object.defineProperty(this,h,{get:()=>{const l=u(r),p=s[i]-l;return this.rect[h]+p},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Ye{constructor(t){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(n=>{var r;return(r=this.target)==null?void 0:r.removeEventListener(...n)})},this.target=t}add(t,n,r){var s;(s=this.target)==null||s.addEventListener(t,n,r),this.listeners.push([t,n,r])}}function Lr(e){const{EventTarget:t}=Ce(e);return e instanceof t?e:qe(e)}function xt(e,t){const n=Math.abs(e.x),r=Math.abs(e.y);return typeof t=="number"?Math.sqrt(n**2+r**2)>t:"x"in t&&"y"in t?n>t.x&&r>t.y:"x"in t?n>t.x:"y"in t?r>t.y:!1}var _e;(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(_e||(_e={}));function Vt(e){e.preventDefault()}function Pr(e){e.stopPropagation()}var G;(function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"})(G||(G={}));const mn={start:[G.Space,G.Enter],cancel:[G.Esc],end:[G.Space,G.Enter,G.Tab]},zr=(e,t)=>{let{currentCoordinates:n}=t;switch(e.code){case G.Right:return{...n,x:n.x+25};case G.Left:return{...n,x:n.x-25};case G.Down:return{...n,y:n.y+25};case G.Up:return{...n,y:n.y-25}}};class vn{constructor(t){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=t;const{event:{target:n}}=t;this.props=t,this.listeners=new Ye(qe(n)),this.windowListeners=new Ye(Ce(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(_e.Resize,this.handleCancel),this.windowListeners.add(_e.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(_e.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:t,onStart:n}=this.props,r=t.node.current;r&&Tr(r),n(Ie)}handleKeyDown(t){if(jt(t)){const{active:n,context:r,options:s}=this.props,{keyboardCodes:i=mn,coordinateGetter:c=zr,scrollBehavior:u="smooth"}=s,{code:h}=t;if(i.end.includes(h)){this.handleEnd(t);return}if(i.cancel.includes(h)){this.handleCancel(t);return}const{collisionRect:l}=r.current,p=l?{x:l.left,y:l.top}:Ie;this.referenceCoordinates||(this.referenceCoordinates=p);const g=c(t,{active:n,context:r.current,currentCoordinates:p});if(g){const C=ct(g,p),x={x:0,y:0},{scrollableAncestors:F}=r.current;for(const E of F){const k=t.code,{isTop:B,isRight:q,isLeft:M,isBottom:P,maxScroll:K,minScroll:U}=pn(E),R=Or(E),o={x:Math.min(k===G.Right?R.right-R.width/2:R.right,Math.max(k===G.Right?R.left:R.left+R.width/2,g.x)),y:Math.min(k===G.Down?R.bottom-R.height/2:R.bottom,Math.max(k===G.Down?R.top:R.top+R.height/2,g.y))},a=k===G.Right&&!q||k===G.Left&&!M,f=k===G.Down&&!P||k===G.Up&&!B;if(a&&o.x!==g.x){const v=E.scrollLeft+C.x,y=k===G.Right&&v<=K.x||k===G.Left&&v>=U.x;if(y&&!C.y){E.scrollTo({left:v,behavior:u});return}y?x.x=E.scrollLeft-v:x.x=k===G.Right?E.scrollLeft-K.x:E.scrollLeft-U.x,x.x&&E.scrollBy({left:-x.x,behavior:u});break}else if(f&&o.y!==g.y){const v=E.scrollTop+C.y,y=k===G.Down&&v<=K.y||k===G.Up&&v>=U.y;if(y&&!C.x){E.scrollTo({top:v,behavior:u});return}y?x.y=E.scrollTop-v:x.y=k===G.Down?E.scrollTop-K.y:E.scrollTop-U.y,x.y&&E.scrollBy({top:-x.y,behavior:u});break}}this.handleMove(t,Ue(ct(g,this.referenceCoordinates),x))}}}handleMove(t,n){const{onMove:r}=this.props;t.preventDefault(),r(n)}handleEnd(t){const{onEnd:n}=this.props;t.preventDefault(),this.detach(),n()}handleCancel(t){const{onCancel:n}=this.props;t.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}vn.activators=[{eventName:"onKeyDown",handler:(e,t,n)=>{let{keyboardCodes:r=mn,onActivation:s}=t,{active:i}=n;const{code:c}=e.nativeEvent;if(r.start.includes(c)){const u=i.activatorNode.current;return u&&e.target!==u?!1:(e.preventDefault(),s?.({event:e.nativeEvent}),!0)}return!1}}];function Yt(e){return!!(e&&"distance"in e)}function Jt(e){return!!(e&&"delay"in e)}class Lt{constructor(t,n,r){var s;r===void 0&&(r=Lr(t.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=t,this.events=n;const{event:i}=t,{target:c}=i;this.props=t,this.events=n,this.document=qe(c),this.documentListeners=new Ye(this.document),this.listeners=new Ye(r),this.windowListeners=new Ye(Ce(c)),this.initialCoordinates=(s=Et(i))!=null?s:Ie,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:t,props:{options:{activationConstraint:n,bypassActivationConstraint:r}}}=this;if(this.listeners.add(t.move.name,this.handleMove,{passive:!1}),this.listeners.add(t.end.name,this.handleEnd),t.cancel&&this.listeners.add(t.cancel.name,this.handleCancel),this.windowListeners.add(_e.Resize,this.handleCancel),this.windowListeners.add(_e.DragStart,Vt),this.windowListeners.add(_e.VisibilityChange,this.handleCancel),this.windowListeners.add(_e.ContextMenu,Vt),this.documentListeners.add(_e.Keydown,this.handleKeydown),n){if(r!=null&&r({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(Jt(n)){this.timeoutId=setTimeout(this.handleStart,n.delay),this.handlePending(n);return}if(Yt(n)){this.handlePending(n);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(t,n){const{active:r,onPending:s}=this.props;s(r,t,this.initialCoordinates,n)}handleStart(){const{initialCoordinates:t}=this,{onStart:n}=this.props;t&&(this.activated=!0,this.documentListeners.add(_e.Click,Pr,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(_e.SelectionChange,this.removeTextSelection),n(t))}handleMove(t){var n;const{activated:r,initialCoordinates:s,props:i}=this,{onMove:c,options:{activationConstraint:u}}=i;if(!s)return;const h=(n=Et(t))!=null?n:Ie,l=ct(s,h);if(!r&&u){if(Yt(u)){if(u.tolerance!=null&&xt(l,u.tolerance))return this.handleCancel();if(xt(l,u.distance))return this.handleStart()}if(Jt(u)&&xt(l,u.tolerance))return this.handleCancel();this.handlePending(u,l);return}t.cancelable&&t.preventDefault(),c(h)}handleEnd(){const{onAbort:t,onEnd:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleCancel(){const{onAbort:t,onCancel:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleKeydown(t){t.code===G.Esc&&this.handleCancel()}removeTextSelection(){var t;(t=this.document.getSelection())==null||t.removeAllRanges()}}const Fr={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Pt extends Lt{constructor(t){const{event:n}=t,r=qe(n.target);super(t,Fr,r)}}Pt.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return!n.isPrimary||n.button!==0?!1:(r?.({event:n}),!0)}}];const Br={move:{name:"mousemove"},end:{name:"mouseup"}};var kt;(function(e){e[e.RightClick=2]="RightClick"})(kt||(kt={}));class Ur extends Lt{constructor(t){super(t,Br,qe(t.event.target))}}Ur.activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return n.button===kt.RightClick?!1:(r?.({event:n}),!0)}}];const yt={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class $r extends Lt{constructor(t){super(t,yt)}static setup(){return window.addEventListener(yt.move.name,t,{capture:!1,passive:!1}),function(){window.removeEventListener(yt.move.name,t)};function t(){}}}$r.activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;const{touches:s}=n;return s.length>1?!1:(r?.({event:n}),!0)}}];var Je;(function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"})(Je||(Je={}));var dt;(function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"})(dt||(dt={}));function qr(e){let{acceleration:t,activator:n=Je.Pointer,canScroll:r,draggingRect:s,enabled:i,interval:c=5,order:u=dt.TreeOrder,pointerCoordinates:h,scrollableAncestors:l,scrollableAncestorRects:p,delta:g,threshold:C}=e;const x=Wr({delta:g,disabled:!i}),[F,E]=Gn(),k=d.useRef({x:0,y:0}),B=d.useRef({x:0,y:0}),q=d.useMemo(()=>{switch(n){case Je.Pointer:return h?{top:h.y,bottom:h.y,left:h.x,right:h.x}:null;case Je.DraggableRect:return s}},[n,s,h]),M=d.useRef(null),P=d.useCallback(()=>{const U=M.current;if(!U)return;const R=k.current.x*B.current.x,o=k.current.y*B.current.y;U.scrollBy(R,o)},[]),K=d.useMemo(()=>u===dt.TreeOrder?[...l].reverse():l,[u,l]);d.useEffect(()=>{if(!i||!l.length||!q){E();return}for(const U of K){if(r?.(U)===!1)continue;const R=l.indexOf(U),o=p[R];if(!o)continue;const{direction:a,speed:f}=Nr(U,o,q,t,C);for(const v of["x","y"])x[v][a[v]]||(f[v]=0,a[v]=0);if(f.x>0||f.y>0){E(),M.current=U,F(P,c),k.current=f,B.current=a;return}}k.current={x:0,y:0},B.current={x:0,y:0},E()},[t,P,r,E,i,c,JSON.stringify(q),JSON.stringify(x),F,l,K,p,JSON.stringify(C)])}const Hr={x:{[me.Backward]:!1,[me.Forward]:!1},y:{[me.Backward]:!1,[me.Forward]:!1}};function Wr(e){let{delta:t,disabled:n}=e;const r=Rt(t);return nt(s=>{if(n||!r||!s)return Hr;const i={x:Math.sign(t.x-r.x),y:Math.sign(t.y-r.y)};return{x:{[me.Backward]:s.x[me.Backward]||i.x===-1,[me.Forward]:s.x[me.Forward]||i.x===1},y:{[me.Backward]:s.y[me.Backward]||i.y===-1,[me.Forward]:s.y[me.Forward]||i.y===1}}},[n,t,r])}function Kr(e,t){const n=t!=null?e.get(t):void 0,r=n?n.node.current:null;return nt(s=>{var i;return t==null?null:(i=r??s)!=null?i:null},[r,t])}function Xr(e,t){return d.useMemo(()=>e.reduce((n,r)=>{const{sensor:s}=r,i=s.activators.map(c=>({eventName:c.eventName,handler:t(c.handler,r)}));return[...n,...i]},[]),[e,t])}var et;(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(et||(et={}));var _t;(function(e){e.Optimized="optimized"})(_t||(_t={}));const Qt=new Map;function Vr(e,t){let{dragging:n,dependencies:r,config:s}=t;const[i,c]=d.useState(null),{frequency:u,measure:h,strategy:l}=s,p=d.useRef(e),g=k(),C=Ge(g),x=d.useCallback(function(B){B===void 0&&(B=[]),!C.current&&c(q=>q===null?B:q.concat(B.filter(M=>!q.includes(M))))},[C]),F=d.useRef(null),E=nt(B=>{if(g&&!n)return Qt;if(!B||B===Qt||p.current!==e||i!=null){const q=new Map;for(let M of e){if(!M)continue;if(i&&i.length>0&&!i.includes(M.id)&&M.rect.current){q.set(M.id,M.rect.current);continue}const P=M.node.current,K=P?new Mt(h(P),P):null;M.rect.current=K,K&&q.set(M.id,K)}return q}return B},[e,i,n,g,h]);return d.useEffect(()=>{p.current=e},[e]),d.useEffect(()=>{g||x()},[n,g]),d.useEffect(()=>{i&&i.length>0&&c(null)},[JSON.stringify(i)]),d.useEffect(()=>{g||typeof u!="number"||F.current!==null||(F.current=setTimeout(()=>{x(),F.current=null},u))},[u,g,x,...r]),{droppableRects:E,measureDroppableContainers:x,measuringScheduled:i!=null};function k(){switch(l){case et.Always:return!1;case et.BeforeDragging:return n;default:return!n}}}function bn(e,t){return nt(n=>e?n||(typeof t=="function"?t(e):e):null,[t,e])}function Yr(e,t){return bn(e,t)}function Jr(e){let{callback:t,disabled:n}=e;const r=At(t),s=d.useMemo(()=>{if(n||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:i}=window;return new i(r)},[r,n]);return d.useEffect(()=>()=>s?.disconnect(),[s]),s}function ht(e){let{callback:t,disabled:n}=e;const r=At(t),s=d.useMemo(()=>{if(n||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:i}=window;return new i(r)},[n]);return d.useEffect(()=>()=>s?.disconnect(),[s]),s}function Qr(e){return new Mt(He(e),e)}function Gt(e,t,n){t===void 0&&(t=Qr);const[r,s]=d.useState(null);function i(){s(h=>{if(!e)return null;if(e.isConnected===!1){var l;return(l=h??n)!=null?l:null}const p=t(e);return JSON.stringify(h)===JSON.stringify(p)?h:p})}const c=Jr({callback(h){if(e)for(const l of h){const{type:p,target:g}=l;if(p==="childList"&&g instanceof HTMLElement&&g.contains(e)){i();break}}}}),u=ht({callback:i});return Ae(()=>{i(),e?(u?.observe(e),c?.observe(document.body,{childList:!0,subtree:!0})):(u?.disconnect(),c?.disconnect())},[e]),r}function Gr(e){const t=bn(e);return cn(e,t)}const Zt=[];function Zr(e){const t=d.useRef(e),n=nt(r=>e?r&&r!==Zt&&e&&t.current&&e.parentNode===t.current.parentNode?r:Tt(e):Zt,[e]);return d.useEffect(()=>{t.current=e},[e]),n}function es(e){const[t,n]=d.useState(null),r=d.useRef(e),s=d.useCallback(i=>{const c=bt(i.target);c&&n(u=>u?(u.set(c,Dt(c)),new Map(u)):null)},[]);return d.useEffect(()=>{const i=r.current;if(e!==i){c(i);const u=e.map(h=>{const l=bt(h);return l?(l.addEventListener("scroll",s,{passive:!0}),[l,Dt(l)]):null}).filter(h=>h!=null);n(u.length?new Map(u):null),r.current=e}return()=>{c(e),c(i)};function c(u){u.forEach(h=>{const l=bt(h);l?.removeEventListener("scroll",s)})}},[s,e]),d.useMemo(()=>e.length?t?Array.from(t.values()).reduce((i,c)=>Ue(i,c),Ie):gn(e):Ie,[e,t])}function en(e,t){t===void 0&&(t=[]);const n=d.useRef(null);return d.useEffect(()=>{n.current=null},t),d.useEffect(()=>{const r=e!==Ie;r&&!n.current&&(n.current=e),!r&&n.current&&(n.current=null)},[e]),n.current?ct(e,n.current):Ie}function ts(e){d.useEffect(()=>{if(!ft)return;const t=e.map(n=>{let{sensor:r}=n;return r.setup==null?void 0:r.setup()});return()=>{for(const n of t)n?.()}},e.map(t=>{let{sensor:n}=t;return n}))}function ns(e,t){return d.useMemo(()=>e.reduce((n,r)=>{let{eventName:s,handler:i}=r;return n[s]=c=>{i(c,t)},n},{}),[e,t])}function xn(e){return d.useMemo(()=>e?Dr(e):null,[e])}const tn=[];function rs(e,t){t===void 0&&(t=He);const[n]=e,r=xn(n?Ce(n):null),[s,i]=d.useState(tn);function c(){i(()=>e.length?e.map(h=>hn(h)?r:new Mt(t(h),h)):tn)}const u=ht({callback:c});return Ae(()=>{u?.disconnect(),c(),e.forEach(h=>u?.observe(h))},[e]),s}function ss(e){if(!e)return null;if(e.children.length>1)return e;const t=e.children[0];return tt(t)?t:e}function is(e){let{measure:t}=e;const[n,r]=d.useState(null),s=d.useCallback(l=>{for(const{target:p}of l)if(tt(p)){r(g=>{const C=t(p);return g?{...g,width:C.width,height:C.height}:C});break}},[t]),i=ht({callback:s}),c=d.useCallback(l=>{const p=ss(l);i?.disconnect(),p&&i?.observe(p),r(p?t(p):null)},[t,i]),[u,h]=lt(c);return d.useMemo(()=>({nodeRef:u,rect:n,setRef:h}),[n,u,h])}const os=[{sensor:Pt,options:{}},{sensor:vn,options:{}}],as={current:{}},at={draggable:{measure:Xt},droppable:{measure:Xt,strategy:et.WhileDragging,frequency:_t.Optimized},dragOverlay:{measure:He}};class Qe extends Map{get(t){var n;return t!=null&&(n=super.get(t))!=null?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(t=>{let{disabled:n}=t;return!n})}getNodeFor(t){var n,r;return(n=(r=this.get(t))==null?void 0:r.node.current)!=null?n:void 0}}const ls={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new Qe,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:ut},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:at,measureDroppableContainers:ut,windowRect:null,measuringScheduled:!1},cs={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:ut,draggableNodes:new Map,over:null,measureDroppableContainers:ut},pt=d.createContext(cs),yn=d.createContext(ls);function us(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new Qe}}}function ds(e,t){switch(t.type){case pe.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case pe.DragMove:return e.draggable.active==null?e:{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case pe.DragEnd:case pe.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case pe.RegisterDroppable:{const{element:n}=t,{id:r}=n,s=new Qe(e.droppable.containers);return s.set(r,n),{...e,droppable:{...e.droppable,containers:s}}}case pe.SetDroppableDisabled:{const{id:n,key:r,disabled:s}=t,i=e.droppable.containers.get(n);if(!i||r!==i.key)return e;const c=new Qe(e.droppable.containers);return c.set(n,{...i,disabled:s}),{...e,droppable:{...e.droppable,containers:c}}}case pe.UnregisterDroppable:{const{id:n,key:r}=t,s=e.droppable.containers.get(n);if(!s||r!==s.key)return e;const i=new Qe(e.droppable.containers);return i.delete(n),{...e,droppable:{...e.droppable,containers:i}}}default:return e}}function fs(e){let{disabled:t}=e;const{active:n,activatorEvent:r,draggableNodes:s}=d.useContext(pt),i=Rt(r),c=Rt(n?.id);return d.useEffect(()=>{if(!t&&!r&&i&&c!=null){if(!jt(i)||document.activeElement===i.target)return;const u=s.get(c);if(!u)return;const{activatorNode:h,node:l}=u;if(!h.current&&!l.current)return;requestAnimationFrame(()=>{for(const p of[h.current,l.current]){if(!p)continue;const g=tr(p);if(g){g.focus();break}}})}},[r,t,s,c,i]),null}function hs(e,t){let{transform:n,...r}=t;return e!=null&&e.length?e.reduce((s,i)=>i({transform:s,...r}),n):n}function ps(e){return d.useMemo(()=>({draggable:{...at.draggable,...e?.draggable},droppable:{...at.droppable,...e?.droppable},dragOverlay:{...at.dragOverlay,...e?.dragOverlay}}),[e?.draggable,e?.droppable,e?.dragOverlay])}function gs(e){let{activeNode:t,measure:n,initialRect:r,config:s=!0}=e;const i=d.useRef(!1),{x:c,y:u}=typeof s=="boolean"?{x:s,y:s}:s;Ae(()=>{if(!c&&!u||!t){i.current=!1;return}if(i.current||!r)return;const l=t?.node.current;if(!l||l.isConnected===!1)return;const p=n(l),g=cn(p,r);if(c||(g.x=0),u||(g.y=0),i.current=!0,Math.abs(g.x)>0||Math.abs(g.y)>0){const C=un(l);C&&C.scrollBy({top:g.y,left:g.x})}},[t,c,u,r,n])}const wn=d.createContext({...Ie,scaleX:1,scaleY:1});var Pe;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})(Pe||(Pe={}));const ms=d.memo(function(t){var n,r,s,i;let{id:c,accessibility:u,autoScroll:h=!0,children:l,sensors:p=os,collisionDetection:g=xr,measuring:C,modifiers:x,...F}=t;const E=d.useReducer(ds,void 0,us),[k,B]=E,[q,M]=ar(),[P,K]=d.useState(Pe.Uninitialized),U=P===Pe.Initialized,{draggable:{active:R,nodes:o,translate:a},droppable:{containers:f}}=k,v=R!=null?o.get(R):null,y=d.useRef({initial:null,translated:null}),N=d.useMemo(()=>{var xe;return R!=null?{id:R,data:(xe=v?.data)!=null?xe:as,rect:y}:null},[R,v]),X=d.useRef(null),[le,ue]=d.useState(null),[O,Z]=d.useState(null),_=Ge(F,Object.values(F)),ie=rt("DndDescribedBy",c),L=d.useMemo(()=>f.getEnabled(),[f]),j=ps(C),{droppableRects:S,measureDroppableContainers:ee,measuringScheduled:te}=Vr(L,{dragging:U,dependencies:[a.x,a.y],config:j.droppable}),Q=Kr(o,R),fe=d.useMemo(()=>O?Et(O):null,[O]),z=_n(),$=Yr(Q,j.draggable.measure);gs({activeNode:R!=null?o.get(R):null,config:z.layoutShiftCompensation,initialRect:$,measure:j.draggable.measure});const D=Gt(Q,j.draggable.measure,$),I=Gt(Q?Q.parentElement:null),V=d.useRef({activatorEvent:null,active:null,activeNode:Q,collisionRect:null,collisions:null,droppableRects:S,draggableNodes:o,draggingNode:null,draggingNodeRect:null,droppableContainers:f,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),ne=f.getNodeFor((n=V.current.over)==null?void 0:n.id),H=is({measure:j.dragOverlay.measure}),Y=(r=H.nodeRef.current)!=null?r:Q,b=U?(s=H.rect)!=null?s:D:null,T=!!(H.nodeRef.current&&H.rect),w=Gr(T?null:D),A=xn(Y?Ce(Y):null),W=Zr(U?ne??Q:null),ge=rs(W),ae=hs(x,{transform:{x:a.x-w.x,y:a.y-w.y,scaleX:1,scaleY:1},activatorEvent:O,active:N,activeNodeRect:D,containerNodeRect:I,draggingNodeRect:b,over:V.current.over,overlayNodeRect:H.rect,scrollableAncestors:W,scrollableAncestorRects:ge,windowRect:A}),J=fe?Ue(fe,a):null,re=es(W),de=en(re),oe=en(re,[D]),se=Ue(ae,de),he=b?Cr(b,ae):null,ce=N&&he?g({active:N,collisionRect:he,droppableRects:S,droppableContainers:L,pointerCoordinates:J}):null,ze=mr(ce,"id"),[ye,Se]=d.useState(null),Fe=T?ae:Ue(ae,oe),st=yr(Fe,(i=ye?.rect)!=null?i:null,D),gt=d.useRef(null),Bt=d.useCallback((xe,Re)=>{let{sensor:Ee,options:Te}=Re;if(X.current==null)return;const ke=o.get(X.current);if(!ke)return;const De=xe.nativeEvent,Ne=new Ee({active:X.current,activeNode:ke,event:De,options:Te,context:V,onAbort(ve){if(!o.get(ve))return;const{onDragAbort:Oe}=_.current,je={id:ve};Oe?.(je),q({type:"onDragAbort",event:je})},onPending(ve,Me,Oe,je){if(!o.get(ve))return;const{onDragPending:Ke}=_.current,Le={id:ve,constraint:Me,initialCoordinates:Oe,offset:je};Ke?.(Le),q({type:"onDragPending",event:Le})},onStart(ve){const Me=X.current;if(Me==null)return;const Oe=o.get(Me);if(!Oe)return;const{onDragStart:je}=_.current,We={activatorEvent:De,active:{id:Me,data:Oe.data,rect:y}};Ve.unstable_batchedUpdates(()=>{je?.(We),K(Pe.Initializing),B({type:pe.DragStart,initialCoordinates:ve,active:Me}),q({type:"onDragStart",event:We}),ue(gt.current),Z(De)})},onMove(ve){B({type:pe.DragMove,coordinates:ve})},onEnd:Be(pe.DragEnd),onCancel:Be(pe.DragCancel)});gt.current=Ne;function Be(ve){return async function(){const{active:Oe,collisions:je,over:We,scrollAdjustedTranslate:Ke}=V.current;let Le=null;if(Oe&&Ke){const{cancelDrop:Xe}=_.current;Le={activatorEvent:De,active:Oe,collisions:je,delta:Ke,over:We},ve===pe.DragEnd&&typeof Xe=="function"&&await Promise.resolve(Xe(Le))&&(ve=pe.DragCancel)}X.current=null,Ve.unstable_batchedUpdates(()=>{B({type:ve}),K(Pe.Uninitialized),Se(null),ue(null),Z(null),gt.current=null;const Xe=ve===pe.DragEnd?"onDragEnd":"onDragCancel";if(Le){const mt=_.current[Xe];mt?.(Le),q({type:Xe,event:Le})}})}}},[o]),En=d.useCallback((xe,Re)=>(Ee,Te)=>{const ke=Ee.nativeEvent,De=o.get(Te);if(X.current!==null||!De||ke.dndKit||ke.defaultPrevented)return;const Ne={active:De};xe(Ee,Re.options,Ne)===!0&&(ke.dndKit={capturedBy:Re.sensor},X.current=Te,Bt(Ee,Re))},[o,Bt]),Ut=Xr(p,En);ts(p),Ae(()=>{D&&P===Pe.Initializing&&K(Pe.Initialized)},[D,P]),d.useEffect(()=>{const{onDragMove:xe}=_.current,{active:Re,activatorEvent:Ee,collisions:Te,over:ke}=V.current;if(!Re||!Ee)return;const De={active:Re,activatorEvent:Ee,collisions:Te,delta:{x:se.x,y:se.y},over:ke};Ve.unstable_batchedUpdates(()=>{xe?.(De),q({type:"onDragMove",event:De})})},[se.x,se.y]),d.useEffect(()=>{const{active:xe,activatorEvent:Re,collisions:Ee,droppableContainers:Te,scrollAdjustedTranslate:ke}=V.current;if(!xe||X.current==null||!Re||!ke)return;const{onDragOver:De}=_.current,Ne=Te.get(ze),Be=Ne&&Ne.rect.current?{id:Ne.id,rect:Ne.rect.current,data:Ne.data,disabled:Ne.disabled}:null,ve={active:xe,activatorEvent:Re,collisions:Ee,delta:{x:ke.x,y:ke.y},over:Be};Ve.unstable_batchedUpdates(()=>{Se(Be),De?.(ve),q({type:"onDragOver",event:ve})})},[ze]),Ae(()=>{V.current={activatorEvent:O,active:N,activeNode:Q,collisionRect:he,collisions:ce,droppableRects:S,draggableNodes:o,draggingNode:Y,draggingNodeRect:b,droppableContainers:f,over:ye,scrollableAncestors:W,scrollAdjustedTranslate:se},y.current={initial:b,translated:he}},[N,Q,ce,he,o,Y,b,S,f,ye,W,se]),qr({...z,delta:a,draggingRect:he,pointerCoordinates:J,scrollableAncestors:W,scrollableAncestorRects:ge});const Dn=d.useMemo(()=>({active:N,activeNode:Q,activeNodeRect:D,activatorEvent:O,collisions:ce,containerNodeRect:I,dragOverlay:H,draggableNodes:o,droppableContainers:f,droppableRects:S,over:ye,measureDroppableContainers:ee,scrollableAncestors:W,scrollableAncestorRects:ge,measuringConfiguration:j,measuringScheduled:te,windowRect:A}),[N,Q,D,O,ce,I,H,o,f,S,ye,ee,W,ge,j,te,A]),kn=d.useMemo(()=>({activatorEvent:O,activators:Ut,active:N,activeNodeRect:D,ariaDescribedById:{draggable:ie},dispatch:B,draggableNodes:o,over:ye,measureDroppableContainers:ee}),[O,Ut,N,D,B,ie,o,ye,ee]);return we.createElement(ln.Provider,{value:M},we.createElement(pt.Provider,{value:kn},we.createElement(yn.Provider,{value:Dn},we.createElement(wn.Provider,{value:st},l)),we.createElement(fs,{disabled:u?.restoreFocus===!1})),we.createElement(ur,{...u,hiddenTextDescribedById:ie}));function _n(){const xe=le?.autoScrollEnabled===!1,Re=typeof h=="object"?h.enabled===!1:h===!1,Ee=U&&!xe&&!Re;return typeof h=="object"?{...h,enabled:Ee}:{enabled:Ee}}}),vs=d.createContext(null),nn="button",bs="Draggable";function xs(e){let{id:t,data:n,disabled:r=!1,attributes:s}=e;const i=rt(bs),{activators:c,activatorEvent:u,active:h,activeNodeRect:l,ariaDescribedById:p,draggableNodes:g,over:C}=d.useContext(pt),{role:x=nn,roleDescription:F="draggable",tabIndex:E=0}=s??{},k=h?.id===t,B=d.useContext(k?wn:vs),[q,M]=lt(),[P,K]=lt(),U=ns(c,t),R=Ge(n);Ae(()=>(g.set(t,{id:t,key:i,node:q,activatorNode:P,data:R}),()=>{const a=g.get(t);a&&a.key===i&&g.delete(t)}),[g,t]);const o=d.useMemo(()=>({role:x,tabIndex:E,"aria-disabled":r,"aria-pressed":k&&x===nn?!0:void 0,"aria-roledescription":F,"aria-describedby":p.draggable}),[r,x,E,k,F,p.draggable]);return{active:h,activatorEvent:u,activeNodeRect:l,attributes:o,isDragging:k,listeners:r?void 0:U,node:q,over:C,setNodeRef:M,setActivatorNodeRef:K,transform:B}}function ys(){return d.useContext(yn)}const ws="Droppable",Cs={timeout:25};function Ss(e){let{data:t,disabled:n=!1,id:r,resizeObserverConfig:s}=e;const i=rt(ws),{active:c,dispatch:u,over:h,measureDroppableContainers:l}=d.useContext(pt),p=d.useRef({disabled:n}),g=d.useRef(!1),C=d.useRef(null),x=d.useRef(null),{disabled:F,updateMeasurementsFor:E,timeout:k}={...Cs,...s},B=Ge(E??r),q=d.useCallback(()=>{if(!g.current){g.current=!0;return}x.current!=null&&clearTimeout(x.current),x.current=setTimeout(()=>{l(Array.isArray(B.current)?B.current:[B.current]),x.current=null},k)},[k]),M=ht({callback:q,disabled:F||!c}),P=d.useCallback((o,a)=>{M&&(a&&(M.unobserve(a),g.current=!1),o&&M.observe(o))},[M]),[K,U]=lt(P),R=Ge(t);return d.useEffect(()=>{!M||!K.current||(M.disconnect(),g.current=!1,M.observe(K.current))},[K,M]),d.useEffect(()=>(u({type:pe.RegisterDroppable,element:{id:r,key:i,disabled:n,node:K,rect:C,data:R}}),()=>u({type:pe.UnregisterDroppable,key:i,id:r})),[r]),d.useEffect(()=>{n!==p.current.disabled&&(u({type:pe.SetDroppableDisabled,id:r,key:i,disabled:n}),p.current.disabled=n)},[r,i,n,u]),{active:c,rect:C,isOver:h?.id===r,node:K,over:h,setNodeRef:U}}function zt(e,t,n){const r=e.slice();return r.splice(n<0?r.length+n:n,0,r.splice(t,1)[0]),r}function Rs(e,t){return e.reduce((n,r,s)=>{const i=t.get(r);return i&&(n[s]=i),n},Array(e.length))}function it(e){return e!==null&&e>=0}function Es(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Ds(e){return typeof e=="boolean"?{draggable:e,droppable:e}:e}const Ft=e=>{let{rects:t,activeIndex:n,overIndex:r,index:s}=e;const i=zt(t,r,n),c=t[s],u=i[s];return!u||!c?null:{x:u.left-c.left,y:u.top-c.top,scaleX:u.width/c.width,scaleY:u.height/c.height}},Cn="Sortable",Sn=we.createContext({activeIndex:-1,containerId:Cn,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:Ft,disabled:{draggable:!1,droppable:!1}});function ks(e){let{children:t,id:n,items:r,strategy:s=Ft,disabled:i=!1}=e;const{active:c,dragOverlay:u,droppableRects:h,over:l,measureDroppableContainers:p}=ys(),g=rt(Cn,n),C=u.rect!==null,x=d.useMemo(()=>r.map(U=>typeof U=="object"&&"id"in U?U.id:U),[r]),F=c!=null,E=c?x.indexOf(c.id):-1,k=l?x.indexOf(l.id):-1,B=d.useRef(x),q=!Es(x,B.current),M=k!==-1&&E===-1||q,P=Ds(i);Ae(()=>{q&&F&&p(x)},[q,x,F,p]),d.useEffect(()=>{B.current=x},[x]);const K=d.useMemo(()=>({activeIndex:E,containerId:g,disabled:P,disableTransforms:M,items:x,overIndex:k,useDragOverlay:C,sortedRects:Rs(x,h),strategy:s}),[E,g,P.draggable,P.droppable,M,x,k,h,C,s]);return we.createElement(Sn.Provider,{value:K},t)}const _s=e=>{let{id:t,items:n,activeIndex:r,overIndex:s}=e;return zt(n,r,s).indexOf(t)},Is=e=>{let{containerId:t,isSorting:n,wasDragging:r,index:s,items:i,newIndex:c,previousItems:u,previousContainerId:h,transition:l}=e;return!l||!r||u!==i&&s===c?!1:n?!0:c!==s&&t===h},Ns={duration:200,easing:"ease"},Rn="transform",Os=Ze.Transition.toString({property:Rn,duration:0,easing:"linear"}),As={roleDescription:"sortable"};function js(e){let{disabled:t,index:n,node:r,rect:s}=e;const[i,c]=d.useState(null),u=d.useRef(n);return Ae(()=>{if(!t&&n!==u.current&&r.current){const h=s.current;if(h){const l=He(r.current,{ignoreTransform:!0}),p={x:h.left-l.left,y:h.top-l.top,scaleX:h.width/l.width,scaleY:h.height/l.height};(p.x||p.y)&&c(p)}}n!==u.current&&(u.current=n)},[t,n,r,s]),d.useEffect(()=>{i&&c(null)},[i]),i}function Ts(e){let{animateLayoutChanges:t=Is,attributes:n,disabled:r,data:s,getNewIndex:i=_s,id:c,strategy:u,resizeObserverConfig:h,transition:l=Ns}=e;const{items:p,containerId:g,activeIndex:C,disabled:x,disableTransforms:F,sortedRects:E,overIndex:k,useDragOverlay:B,strategy:q}=d.useContext(Sn),M=Ms(r,x),P=p.indexOf(c),K=d.useMemo(()=>({sortable:{containerId:g,index:P,items:p},...s}),[g,s,P,p]),U=d.useMemo(()=>p.slice(p.indexOf(c)),[p,c]),{rect:R,node:o,isOver:a,setNodeRef:f}=Ss({id:c,data:K,disabled:M.droppable,resizeObserverConfig:{updateMeasurementsFor:U,...h}}),{active:v,activatorEvent:y,activeNodeRect:N,attributes:X,setNodeRef:le,listeners:ue,isDragging:O,over:Z,setActivatorNodeRef:_,transform:ie}=xs({id:c,data:K,attributes:{...As,...n},disabled:M.draggable}),L=Qn(f,le),j=!!v,S=j&&!F&&it(C)&&it(k),ee=!B&&O,te=ee&&S?ie:null,fe=S?te??(u??q)({rects:E,activeNodeRect:N,activeIndex:C,overIndex:k,index:P}):null,z=it(C)&&it(k)?i({id:c,items:p,activeIndex:C,overIndex:k}):P,$=v?.id,D=d.useRef({activeId:$,items:p,newIndex:z,containerId:g}),I=p!==D.current.items,V=t({active:v,containerId:g,isDragging:O,isSorting:j,id:c,index:P,items:p,newIndex:D.current.newIndex,previousItems:D.current.items,previousContainerId:D.current.containerId,transition:l,wasDragging:D.current.activeId!=null}),ne=js({disabled:!V,index:P,node:o,rect:R});return d.useEffect(()=>{j&&D.current.newIndex!==z&&(D.current.newIndex=z),g!==D.current.containerId&&(D.current.containerId=g),p!==D.current.items&&(D.current.items=p)},[j,z,g,p]),d.useEffect(()=>{if($===D.current.activeId)return;if($!=null&&D.current.activeId==null){D.current.activeId=$;return}const Y=setTimeout(()=>{D.current.activeId=$},50);return()=>clearTimeout(Y)},[$]),{active:v,activeIndex:C,attributes:X,data:K,rect:R,index:P,newIndex:z,items:p,isOver:a,isSorting:j,isDragging:O,listeners:ue,node:o,overIndex:k,over:Z,setNodeRef:L,setActivatorNodeRef:_,setDroppableNodeRef:f,setDraggableNodeRef:le,transform:ne??fe,transition:H()};function H(){if(ne||I&&D.current.newIndex===P)return Os;if(!(ee&&!jt(y)||!l)&&(j||V))return Ze.Transition.toString({...l,property:Rn})}}function Ms(e,t){var n,r;return typeof e=="boolean"?{draggable:e,droppable:!1}:{draggable:(n=e?.draggable)!=null?n:t.draggable,droppable:(r=e?.droppable)!=null?r:t.droppable}}G.Down,G.Right,G.Up,G.Left;const Ls=({name:e,detail:t,selected:n,disabled:r,onUpdate:s})=>m.jsxs("div",{className:"mt-5 space-y-3 text-foreground text-sm",children:[m.jsxs("label",{className:"flex items-center gap-3",children:[m.jsx("span",{className:"w-20",children:"賞名"}),m.jsx("input",{className:"h-8 w-full rounded border border-input bg-background px-2 text-foreground text-sm",value:e,onChange:i=>{const c=i.target.value;s?.({prizeName:c})},onBlur:()=>{if(!s)return;const i=e.trim();i!==e&&s({prizeName:i})},placeholder:"賞名を入力",disabled:r})]}),m.jsxs("label",{className:"flex items-center gap-3",children:[m.jsx("span",{className:"w-20",children:"賞品名"}),m.jsx("input",{className:"h-8 w-full rounded border border-input bg-background px-2 text-foreground text-sm",value:t,onChange:i=>{const c=i.target.value;s?.({itemName:c})},onBlur:()=>{if(!s)return;const i=t.trim();i!==t&&s({itemName:i})},placeholder:"賞品名を入力",disabled:r})]}),m.jsxs("label",{className:"flex items-center gap-3",children:[m.jsx("span",{className:"w-20",children:"選出"}),m.jsxs("select",{className:"h-8 w-full rounded border border-input bg-background px-2 text-foreground text-sm",value:n?"selected":"unselected",onChange:i=>{const c=i.target.value==="selected";s&&s({selected:c})},disabled:r,children:[m.jsx("option",{value:"unselected",children:"未選出"}),m.jsx("option",{value:"selected",children:"選出"})]})]})]}),Ps=({id:e,name:t,imagePath:n,disabled:r,onUpdate:s})=>{const i=d.useId(),c=d.useRef(null),u=jn(n),h=()=>{c.current?.click()},l=g=>{const C=g.target.files?.[0];C&&C.type.startsWith("image/")&&wt(e,C).then(()=>{s?.({imagePath:Ct(e)})}).catch(()=>{})},p=()=>{n&&Tn(e).then(()=>{s?.({imagePath:null})}).catch(()=>{})};return m.jsxs(m.Fragment,{children:[m.jsx(be,{type:"button",className:rn("flex h-32 w-full items-center justify-center rounded bg-background! p-0! text-foreground text-lg",u||"border-2 border-border"),onClick:h,disabled:r,children:u?m.jsxs(m.Fragment,{children:[m.jsx("img",{src:u,alt:`${t||"景品"} 画像`,className:"h-32 w-64.5 rounded object-cover object-center"}),m.jsx(be,{type:"button",className:"absolute top-28 right-8 z-60 h-8! bg-secondary px-2! py-1! text-xs",onClick:p,disabled:r||!n,children:m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx($t,{className:"h-4 w-4"}),m.jsx("span",{children:"削除"})]})})]}):m.jsxs("div",{className:"flex h-32 w-64.5 flex-col items-center gap-1 pt-2 text-muted-foreground",children:[m.jsx($t,{className:"h-20 w-20 text-muted-foreground"}),m.jsx("span",{children:"クリックで画像を追加"})]})}),m.jsx("input",{ref:c,id:i,type:"file",accept:"image/*",className:"sr-only",onChange:l,disabled:r})]})},zs=({id:e,name:t,detail:n,imagePath:r,selected:s,disabled:i,onRemove:c,onUpdate:u,dndId:h})=>{const{attributes:l,listeners:p,setNodeRef:g,transform:C,transition:x,isDragging:F}=Ts({id:h??e}),E={transform:Ze.Transform.toString(C),transition:x};return m.jsxs("li",{ref:g,style:E,className:rn("relative w-full max-w-75 rounded-3xl bg-card p-6 shadow-[0_12px_24px_hsl(var(--foreground)/0.16)] transition-transform duration-200 ease-out",F?"bg-muted":"bg-card"),...l,...p,children:[m.jsx(be,{type:"button",variant:"ghost",className:"absolute top-2 right-2 rounded-full! bg-muted/90 px-2! hover:bg-muted/80!","aria-label":"削除",onClick:c,disabled:i||!c,children:m.jsx(Pn,{className:"h-6 w-6 text-muted-foreground"})}),m.jsx(Ps,{id:e,name:t,imagePath:r,disabled:i,onUpdate:u}),m.jsx(Ls,{name:t,detail:n,selected:s,disabled:i,onUpdate:u})]})},Fs=({prizes:e,disabled:t=!1,onReorder:n,onRemove:r,onUpdate:s})=>{const i=fr(dr(Pt,{activationConstraint:{distance:5}})),c=d.useMemo(()=>e.map(l=>l.id),[e]),u=l=>String(l),h=({active:l,over:p})=>{if(!p)return;const g=u(l.id),C=u(p.id);if(g===C)return;const x=c.indexOf(g),F=c.indexOf(C);if(x===-1||F===-1)return;const E=zt(c,x,F);n(E)};return e.length===0?m.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2",children:m.jsx("span",{className:"rounded-3xl bg-card p-6 text-3xl text-muted-foreground",children:"景品が登録されてないよ"})}):m.jsx(ms,{sensors:i,collisionDetection:vr,onDragEnd:h,children:m.jsx(ks,{items:c,strategy:Ft,children:m.jsx("div",{className:"flex w-full justify-center pt-16",children:m.jsx("ul",{className:"mx-auto flex w-325 flex-wrap justify-start gap-4","data-testid":"setting-prize-list",id:"setting-prize-list",children:e.map(l=>m.jsx(zs,{id:l.id,name:l.prizeName,detail:l.itemName,imagePath:l.imagePath,selected:l.selected,disabled:t,onRemove:()=>r?.(l.id),onUpdate:p=>s?.(l.id,p)},l.id))})})})})},Bs=({open:e,title:t="選出状態をリセットする？",description:n="最初からゲームを始めたいときにオススメ！",onClose:r,onConfirm:s,disabled:i=!1})=>m.jsx(It,{open:e,onClose:r,title:t,description:n,showCloseButton:!0,closeDisabled:i,footer:m.jsxs(m.Fragment,{children:[m.jsx(be,{type:"button",className:"flex-1 rounded-2xl px-4 py-3",onClick:r,disabled:i,children:"キャンセル"}),m.jsx(be,{type:"button",variant:"outline",className:"flex-1 rounded-2xl px-4 py-3",onClick:s,disabled:i,children:"OK"})]})}),Us=({disabled:e=!1,onFileImport:t,manualCsv:n,onManualCsvChange:r,onManualImport:s,onExport:i,summary:c,error:u,exportText:h})=>{const l=async p=>{const g=p.target.files?.[0];g&&(await t(g),p.target.value="")};return m.jsxs("div",{className:"rounded border border-border bg-muted p-4 text-muted-foreground text-xs",children:[m.jsxs("div",{className:"flex flex-col gap-3 lg:flex-row lg:items-end",children:[m.jsxs("div",{className:"flex-1",children:[m.jsx("label",{className:"block text-[11px] text-muted-foreground",htmlFor:"csv-import",children:"CSV インポート"}),m.jsx("input",{id:"csv-import",type:"file",accept:".csv,text/csv",className:"mt-2 w-full rounded border border-input bg-background px-3 py-2 text-foreground text-xs",onChange:l,disabled:e})]}),m.jsx("div",{className:"flex items-end gap-2",children:m.jsx(be,{type:"button",className:"rounded bg-primary px-3 py-2 text-primary-foreground text-xs shadow-sm hover:bg-primary disabled:opacity-50",onClick:i,disabled:e,children:"CSV エクスポート"})})]}),m.jsxs("div",{className:"mt-4 grid gap-3 lg:grid-cols-[2fr,1fr]",children:[m.jsx("textarea",{"aria-label":"CSV 貼り付け",className:"rounded border border-input bg-background p-3 text-foreground text-xs",rows:5,value:n,onChange:p=>r(p.target.value)}),m.jsx(be,{type:"button",className:"rounded border border-primary px-3 py-2 text-primary text-xs shadow-sm hover:bg-primary/10 disabled:opacity-50",onClick:s,disabled:e,children:"貼り付け内容を取り込む"})]}),c&&m.jsxs("div",{className:"mt-4 rounded border border-border bg-accent p-3 text-[11px] text-accent-foreground",children:[m.jsxs("p",{children:[c.sourceName," を取り込みました（追加 ",c.addedCount," 件、スキップ"," ",c.skipped.length," 件）"]}),c.skipped.length>0&&m.jsx("ul",{className:"mt-2 list-disc pl-4",children:c.skipped.map(p=>m.jsxs("li",{children:[p.id||"(no id)",": ",p.reason]},`${p.id}-${p.reason}`))})]}),u&&m.jsx("p",{className:"mt-3 text-[11px] text-destructive",children:u}),h&&m.jsx("textarea",{className:"mt-4 w-full rounded border border-input bg-background p-3 text-foreground text-xs",rows:5,readOnly:!0,value:h,"data-testid":"export-preview"})]})},$s=({isMutating:e,isUploading:t,manualCsv:n,onManualCsvChange:r,onManualImport:s,onExport:i,onFileImport:c,onCsvImport:u,onImageImport:h,summary:l,error:p,exportText:g})=>m.jsxs("div",{className:"sr-only",children:[m.jsx("input",{id:"csv-import-simple",type:"file",accept:".csv,text/csv",onChange:C=>{const x=C.target.files?.[0];x&&u(x),C.currentTarget.value=""}}),m.jsx("input",{id:"image-import-simple",type:"file",accept:"image/*",multiple:!0,onChange:C=>{const x=C.target.files;x&&h(x),C.currentTarget.value=""},disabled:t||e}),m.jsx(Us,{disabled:e,onFileImport:c,manualCsv:n,onManualCsvChange:r,onManualImport:s,onExport:i,summary:l,error:p,exportText:g})]}),qs=({isMutating:e,isSaving:t,hasPrizes:n,onAddCard:r,onCsvImportClick:s,onImageUploadClick:i,onResetSelections:c,onDeleteAll:u,onBack:h})=>m.jsx("header",{className:"fixed top-0 left-0 z-100 w-full bg-background py-2 shadow",children:m.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 px-8",children:[m.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[m.jsx(be,{type:"button",className:"rounded bg-primary px-3 py-1.5 text-primary-foreground text-xs shadow-none hover:bg-primary disabled:opacity-50",onClick:r,disabled:e,children:"追加"}),m.jsx(be,{type:"button",variant:"outline",className:"rounded border border-border px-3 py-1.5 text-muted-foreground text-xs shadow-none hover:bg-muted disabled:opacity-50",onClick:s,disabled:e,children:"CSV追加"}),m.jsx(be,{type:"button",variant:"outline",className:"rounded border border-border px-3 py-1.5 text-muted-foreground text-xs shadow-none hover:bg-muted disabled:opacity-50",onClick:i,disabled:e||!n,children:"画像追加"}),m.jsx(be,{type:"button",variant:"outline",className:"rounded border border-border px-3 py-1.5 text-muted-foreground text-xs shadow-none hover:bg-muted disabled:opacity-50",onClick:c,disabled:e||!n,children:"全未選出"}),m.jsx(be,{type:"button",variant:"destructive",className:"rounded border border-destructive px-3 py-1.5 text-destructive text-xs shadow-none hover:bg-destructive/10 disabled:opacity-50",onClick:u,disabled:e||!n,children:"全削除"})]}),m.jsx(be,{type:"button",className:"rounded bg-secondary px-3 py-1.5 text-secondary-foreground text-xs shadow-none hover:bg-secondary/80",onClick:h,disabled:t||e,children:"戻る"})]})}),Hs=({open:e,onCancel:t,onProceed:n})=>m.jsx(It,{open:e,onClose:t,title:"編集中のデータが消えちゃいます！",description:"保存したかったら戻るボタンを押してね。",footer:m.jsxs(m.Fragment,{children:[m.jsx(be,{type:"button",className:"flex-1 rounded-2xl border border-border px-4 py-3 text-muted-foreground hover:bg-muted",onClick:t,children:"キャンセル"}),m.jsx(be,{type:"button",variant:"outline",className:"flex-1 rounded-2xl px-4 py-3",onClick:n,children:"移動する！"})]})}),Ws=()=>{const{prizes:e,isLoading:t,isMutating:n,error:r,applyPrizes:s}=Mn(),{draftPrizes:i,summary:c,exportText:u,manualCsv:h,deleteOpen:l,resetOpen:p,confirmOpen:g,isSaving:C,isUploading:x,combinedError:F,setManualCsv:E,setDeleteOpen:k,setResetOpen:B,handleAddCard:q,handleCsvImportClick:M,handleImageUploadClick:P,handleFileImport:K,handleManualImport:U,handleExport:R,handleCsvImport:o,handleUploadImages:a,handleDeleteAll:f,handleResetSelections:v,handleReorder:y,handleRemove:N,handleUpdate:X,handleSaveAndBack:le,handleCancelConfirm:ue,handleConfirmProceed:O}=Yn({prizes:e,isLoading:t,error:r,applyPrizes:s});return m.jsxs("section",{className:"space-y-3",children:[m.jsx(qs,{isMutating:n,isSaving:C,hasPrizes:i.length>0,onAddCard:q,onCsvImportClick:M,onImageUploadClick:P,onResetSelections:()=>B(!0),onDeleteAll:()=>k(!0),onBack:()=>{le()}}),m.jsx($s,{isMutating:n,isUploading:x,manualCsv:h,onManualCsvChange:E,onManualImport:U,onExport:R,onFileImport:K,onCsvImport:o,onImageImport:a,summary:c,error:F,exportText:u}),t?m.jsx("p",{className:"px-4 py-6 text-muted-foreground text-sm",children:"読み込み中..."}):m.jsx(Fs,{prizes:i,onReorder:y,onRemove:N,onUpdate:X,disabled:n}),m.jsx(Jn,{open:l,onClose:()=>k(!1),onConfirm:f,disabled:n}),m.jsx(Bs,{open:p,onClose:()=>B(!1),onConfirm:v,disabled:n}),m.jsx(Hs,{open:g,onCancel:ue,onProceed:O})]})},Ys=An(function(){return m.jsx("main",{className:"min-h-screen bg-background p-2 text-foreground",children:m.jsx("div",{className:"w-full bg-background p-3",children:m.jsx(zn,{enabled:!1,children:m.jsx(Ln,{children:m.jsx(Ws,{})})})})})});export{Ys as default};
