# 景品ルーレット結果リセット調査

## ステータス
- 対応済み（Game セッションと景品状態を分離し、番号抽選が `storageKeys.prizes` を上書きしない構造へ変更）

## 再現手順
1. Game 画面で任意の抽選番号を「抽選を開始！」ボタンで決定する。
2. 右パネルで「景品ルーレット」を押し、抽選が完了するまで待つ。
3. 結果ダイアログを開いたまま、再度「抽選を開始！」で番号抽選を行う。
4. 再び「景品ルーレット」を押す。
   - 期待値: 新しい景品抽選が始まるまでは 2. の結果が表示されたままになる。
   - 実際: 4. でボタンを押した瞬間に結果ダイアログが閉じ、2. の当選結果がリセットされる。

## 原因
- Game セッション永続化（`persistSessionState`）が `storageKeys.prizes` を丸ごと上書きできる設計になっており、番号抽選・リセットのたびに「古い景品状態」が保存されると景品当選が巻き戻る。
- さらに Game 側が景品一覧を `initialPrizes` として注入していると、景品側（`PrizeProvider`）が「古いスナップショット」で再初期化され、景品ルーレット結果（当選状態）も巻き戻って見える。
- なお `window.addEventListener("storage", ...)` の `storage` イベントは **同一タブ内の localStorage 更新では発火しない**（別タブ/別ウィンドウ向け）。この不具合の主因は「同一タブ内で景品状態が古い内容で上書きされ、それが画面再描画で反映される」点にある。

## あるべき実装
- 景品状態（`storageKeys.prizes`）は Prize 側の責務として扱い、Game 側の永続化から切り離す（番号抽選・リセットで `storageKeys.prizes` を上書きしない）。
- Game 側が景品一覧のスナップショットを注入して再初期化を誘発しないよう、Game 画面では `PrizeProvider` が自前で景品状態を読み込む構造にする。

## 対応方針
- `persistSessionState` は GameState/BGM のみを保存対象にし、景品一覧は `prizeService` が単独で永続化する。
- Game 画面から `PrizeProvider` へ `initialPrizes` を渡すのをやめ、景品コンポーネント群（PrizeProvider/PrizeContext）内で state を保持する。
