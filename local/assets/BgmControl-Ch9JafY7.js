import{r as l,j as d,b as I}from"./chunk-JMJ3UQ3L-CakUOnqu.js";import{c as ne,s as M,r as N,w as T,B as ye,u as Re,d as oe,e as D,f as te,g as Me,h as j,P as V,i as F}from"./CommonDialog-Dfx684_S.js";const Pe=[["path",{d:"M16 9a5 5 0 0 1 .95 2.293",key:"1fgyg8"}],["path",{d:"M19.364 5.636a9 9 0 0 1 1.889 9.96",key:"l3zxae"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"m7 7-.587.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298V11",key:"1gbwow"}],["path",{d:"M9.828 4.172A.686.686 0 0 1 11 4.657v.686",key:"s2je0y"}]],Ee=ne("volume-off",Pe);const De=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],Ce=ne("volume-2",De),Ae=0,$=(e=new Date().toISOString(),t=Ae)=>({enabled:!0,volume:t,updatedAt:e}),Ie=async(e=M.bgm,t)=>{const n=N(e,null);if(!n){const o=$(new Date().toISOString(),t);return T(e,o),o}return n},G=async(e,t=M.bgm)=>{T(t,e)},U=e=>e instanceof Error?e.message:"unknown-error",dt=(e={})=>{const[t,n]=l.useState(()=>$()),[o,i]=l.useState(!1),[c,s]=l.useState(null),a=e.storageKey??M.bgm,f=e.defaultVolume;l.useEffect(()=>{let r=!0;return Ie(a,f).then(u=>{if(r){if(e.resetOnLoad&&u.volume!==0){const x={...u,enabled:!1,volume:0,updatedAt:new Date().toISOString()};n(x),G(x,a),i(!0);return}n(u),i(!0)}}).catch(u=>{r&&(n($(new Date().toISOString(),f)),i(!0),s(U(u)))}),()=>{r=!1}},[f,e.resetOnLoad,a]);const g=l.useCallback(async()=>{const r={...t,enabled:!t.enabled,updatedAt:new Date().toISOString()};n(r);try{await G(r,a),s(null)}catch(u){n(t),s(U(u))}},[t,a]),m=l.useCallback(async r=>{const u=r>0,x={...t,enabled:u,volume:r,updatedAt:new Date().toISOString()};n(x);try{await G(x,a),s(null)}catch(v){n(t),s(U(v))}},[t,a]);return{preference:t,isReady:o,toggle:g,setVolume:m,error:c}},_e=.1,je=e=>({currentNumber:null,drawHistory:[],isDrawing:!1,createdAt:e,updatedAt:e}),Ne=e=>({enabled:!0,volume:_e,updatedAt:e}),ze=()=>N(M.gameState,null),J=()=>N(M.prizes,[]),re=e=>N(M.bgm,null)??Ne(e),Be=e=>e.map(t=>({...t,selected:!1})),ut=async(e={})=>{const t=new Date().toISOString(),n=e.resetPrizes??!0,o=J(),i=n?Be(o):[...o],c=je(t),s=re(t);return await ke({gameState:c,prizes:i,bgm:s}),{gameState:c,prizes:i,bgm:s}},ft=async()=>{const e=ze();if(!e)return null;const t=new Date().toISOString(),n=J(),o=re(t);return{gameState:e,prizes:n,bgm:o}},ke=async e=>{T(M.gameState,e.gameState),T(M.prizes,e.prizes),T(M.bgm,e.bgm)},mt=()=>{const e=N(M.gameState,null);return e?e.drawHistory.length>0:!1},St=()=>J().some(t=>t.selected),ht=()=>N(M.gameState,null)!==null,Oe=({enabled:e,onToggle:t,disabled:n=!1})=>{const o=e?"BGM をオフにする":"BGM をオンにする";return d.jsx(ye,{type:"button",className:"rounded-full border border-border bg-background/80 p-2 text-foreground shadow-sm hover:bg-muted focus:outline-none","aria-pressed":e,"aria-label":o,onClick:t,disabled:n,children:e?d.jsx(Ce,{className:"h-6 w-6","aria-hidden":"true"}):d.jsx(Ee,{className:"h-6 w-6","aria-hidden":"true"})})};function se(e,[t,n]){return Math.min(n,Math.max(t,e))}var Te=l.createContext(void 0);function Ve(e){const t=l.useContext(Te);return e||t||"ltr"}function Ke(e){const t=l.useRef({value:e,previous:e});return l.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}function Le(e){const[t,n]=l.useState(void 0);return Re(()=>{if(e){n({width:e.offsetWidth,height:e.offsetHeight});const o=new ResizeObserver(i=>{if(!Array.isArray(i)||!i.length)return;const c=i[0];let s,a;if("borderBoxSize"in c){const f=c.borderBoxSize,g=Array.isArray(f)?f[0]:f;s=g.inlineSize,a=g.blockSize}else s=e.offsetWidth,a=e.offsetHeight;n({width:s,height:a})});return o.observe(e,{box:"border-box"}),()=>o.unobserve(e)}else n(void 0)},[e]),t}function He(e){const t=e+"CollectionProvider",[n,o]=oe(t),[i,c]=n(t,{collectionRef:{current:null},itemMap:new Map}),s=b=>{const{scope:S,children:h}=b,y=I.useRef(null),w=I.useRef(new Map).current;return d.jsx(i,{scope:S,itemMap:w,collectionRef:y,children:h})};s.displayName=t;const a=e+"CollectionSlot",f=te(a),g=I.forwardRef((b,S)=>{const{scope:h,children:y}=b,w=c(a,h),p=D(S,w.collectionRef);return d.jsx(f,{ref:p,children:y})});g.displayName=a;const m=e+"CollectionItemSlot",r="data-radix-collection-item",u=te(m),x=I.forwardRef((b,S)=>{const{scope:h,children:y,...w}=b,p=I.useRef(null),P=D(S,p),E=c(m,h);return I.useEffect(()=>(E.itemMap.set(p,{ref:p,...w}),()=>{E.itemMap.delete(p)})),d.jsx(u,{[r]:"",ref:P,children:y})});x.displayName=m;function v(b){const S=c(e+"CollectionConsumer",b);return I.useCallback(()=>{const y=S.collectionRef.current;if(!y)return[];const w=Array.from(y.querySelectorAll(`[${r}]`));return Array.from(S.itemMap.values()).sort((E,B)=>w.indexOf(E.ref.current)-w.indexOf(B.ref.current))},[S.collectionRef,S.itemMap])}return[{Provider:s,Slot:g,ItemSlot:x},v,o]}var ae=["PageUp","PageDown"],ie=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],ce={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},z="Slider",[Y,Ge,Ue]=He(z),[le]=oe(z,[Ue]),[Fe,K]=le(z),de=l.forwardRef((e,t)=>{const{name:n,min:o=0,max:i=100,step:c=1,orientation:s="horizontal",disabled:a=!1,minStepsBetweenThumbs:f=0,defaultValue:g=[o],value:m,onValueChange:r=()=>{},onValueCommit:u=()=>{},inverted:x=!1,form:v,...b}=e,S=l.useRef(new Set),h=l.useRef(0),w=s==="horizontal"?$e:Ye,[p=[],P]=Me({prop:m,defaultProp:g,onChange:R=>{[...S.current][h.current]?.focus(),r(R)}}),E=l.useRef(p);function B(R){const C=Qe(p,R);k(R,C)}function we(R){k(R,h.current)}function ve(){const R=E.current[h.current];p[h.current]!==R&&u(p)}function k(R,C,{commit:L}={commit:!1}){const Z=nt(c),H=ot(Math.round((R-o)/c)*c+o,Z),O=se(H,[o,i]);P((_=[])=>{const A=Xe(_,O,C);if(tt(A,f*c)){h.current=A.indexOf(O);const ee=String(A)!==String(_);return ee&&L&&u(A),ee?A:_}else return _})}return d.jsx(Fe,{scope:e.__scopeSlider,name:n,disabled:a,min:o,max:i,valueIndexToChangeRef:h,thumbs:S.current,values:p,orientation:s,form:v,children:d.jsx(Y.Provider,{scope:e.__scopeSlider,children:d.jsx(Y.Slot,{scope:e.__scopeSlider,children:d.jsx(w,{"aria-disabled":a,"data-disabled":a?"":void 0,...b,ref:t,onPointerDown:j(b.onPointerDown,()=>{a||(E.current=p)}),min:o,max:i,inverted:x,onSlideStart:a?void 0:B,onSlideMove:a?void 0:we,onSlideEnd:a?void 0:ve,onHomeKeyDown:()=>!a&&k(o,0,{commit:!0}),onEndKeyDown:()=>!a&&k(i,p.length-1,{commit:!0}),onStepKeyDown:({event:R,direction:C})=>{if(!a){const H=ae.includes(R.key)||R.shiftKey&&ie.includes(R.key)?10:1,O=h.current,_=p[O],A=c*H*C;k(_+A,O,{commit:!0})}}})})})})});de.displayName=z;var[ue,fe]=le(z,{startEdge:"left",endEdge:"right",size:"width",direction:1}),$e=l.forwardRef((e,t)=>{const{min:n,max:o,dir:i,inverted:c,onSlideStart:s,onSlideMove:a,onSlideEnd:f,onStepKeyDown:g,...m}=e,[r,u]=l.useState(null),x=D(t,w=>u(w)),v=l.useRef(void 0),b=Ve(i),S=b==="ltr",h=S&&!c||!S&&c;function y(w){const p=v.current||r.getBoundingClientRect(),P=[0,p.width],B=Q(P,h?[n,o]:[o,n]);return v.current=p,B(w-p.left)}return d.jsx(ue,{scope:e.__scopeSlider,startEdge:h?"left":"right",endEdge:h?"right":"left",direction:h?1:-1,size:"width",children:d.jsx(me,{dir:b,"data-orientation":"horizontal",...m,ref:x,style:{...m.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:w=>{const p=y(w.clientX);s?.(p)},onSlideMove:w=>{const p=y(w.clientX);a?.(p)},onSlideEnd:()=>{v.current=void 0,f?.()},onStepKeyDown:w=>{const P=ce[h?"from-left":"from-right"].includes(w.key);g?.({event:w,direction:P?-1:1})}})})}),Ye=l.forwardRef((e,t)=>{const{min:n,max:o,inverted:i,onSlideStart:c,onSlideMove:s,onSlideEnd:a,onStepKeyDown:f,...g}=e,m=l.useRef(null),r=D(t,m),u=l.useRef(void 0),x=!i;function v(b){const S=u.current||m.current.getBoundingClientRect(),h=[0,S.height],w=Q(h,x?[o,n]:[n,o]);return u.current=S,w(b-S.top)}return d.jsx(ue,{scope:e.__scopeSlider,startEdge:x?"bottom":"top",endEdge:x?"top":"bottom",size:"height",direction:x?1:-1,children:d.jsx(me,{"data-orientation":"vertical",...g,ref:r,style:{...g.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:b=>{const S=v(b.clientY);c?.(S)},onSlideMove:b=>{const S=v(b.clientY);s?.(S)},onSlideEnd:()=>{u.current=void 0,a?.()},onStepKeyDown:b=>{const h=ce[x?"from-bottom":"from-top"].includes(b.key);f?.({event:b,direction:h?-1:1})}})})}),me=l.forwardRef((e,t)=>{const{__scopeSlider:n,onSlideStart:o,onSlideMove:i,onSlideEnd:c,onHomeKeyDown:s,onEndKeyDown:a,onStepKeyDown:f,...g}=e,m=K(z,n);return d.jsx(V.span,{...g,ref:t,onKeyDown:j(e.onKeyDown,r=>{r.key==="Home"?(s(r),r.preventDefault()):r.key==="End"?(a(r),r.preventDefault()):ae.concat(ie).includes(r.key)&&(f(r),r.preventDefault())}),onPointerDown:j(e.onPointerDown,r=>{const u=r.target;u.setPointerCapture(r.pointerId),r.preventDefault(),m.thumbs.has(u)?u.focus():o(r)}),onPointerMove:j(e.onPointerMove,r=>{r.target.hasPointerCapture(r.pointerId)&&i(r)}),onPointerUp:j(e.onPointerUp,r=>{const u=r.target;u.hasPointerCapture(r.pointerId)&&(u.releasePointerCapture(r.pointerId),c(r))})})}),Se="SliderTrack",he=l.forwardRef((e,t)=>{const{__scopeSlider:n,...o}=e,i=K(Se,n);return d.jsx(V.span,{"data-disabled":i.disabled?"":void 0,"data-orientation":i.orientation,...o,ref:t})});he.displayName=Se;var W="SliderRange",ge=l.forwardRef((e,t)=>{const{__scopeSlider:n,...o}=e,i=K(W,n),c=fe(W,n),s=l.useRef(null),a=D(t,s),f=i.values.length,g=i.values.map(u=>be(u,i.min,i.max)),m=f>1?Math.min(...g):0,r=100-Math.max(...g);return d.jsx(V.span,{"data-orientation":i.orientation,"data-disabled":i.disabled?"":void 0,...o,ref:a,style:{...e.style,[c.startEdge]:m+"%",[c.endEdge]:r+"%"}})});ge.displayName=W;var q="SliderThumb",pe=l.forwardRef((e,t)=>{const n=Ge(e.__scopeSlider),[o,i]=l.useState(null),c=D(t,a=>i(a)),s=l.useMemo(()=>o?n().findIndex(a=>a.ref.current===o):-1,[n,o]);return d.jsx(We,{...e,ref:c,index:s})}),We=l.forwardRef((e,t)=>{const{__scopeSlider:n,index:o,name:i,...c}=e,s=K(q,n),a=fe(q,n),[f,g]=l.useState(null),m=D(t,y=>g(y)),r=f?s.form||!!f.closest("form"):!0,u=Le(f),x=s.values[o],v=x===void 0?0:be(x,s.min,s.max),b=Je(o,s.values.length),S=u?.[a.size],h=S?Ze(S,v,a.direction):0;return l.useEffect(()=>{if(f)return s.thumbs.add(f),()=>{s.thumbs.delete(f)}},[f,s.thumbs]),d.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[a.startEdge]:`calc(${v}% + ${h}px)`},children:[d.jsx(Y.ItemSlot,{scope:e.__scopeSlider,children:d.jsx(V.span,{role:"slider","aria-label":e["aria-label"]||b,"aria-valuemin":s.min,"aria-valuenow":x,"aria-valuemax":s.max,"aria-orientation":s.orientation,"data-orientation":s.orientation,"data-disabled":s.disabled?"":void 0,tabIndex:s.disabled?void 0:0,...c,ref:m,style:x===void 0?{display:"none"}:e.style,onFocus:j(e.onFocus,()=>{s.valueIndexToChangeRef.current=o})})}),r&&d.jsx(xe,{name:i??(s.name?s.name+(s.values.length>1?"[]":""):void 0),form:s.form,value:x},o)]})});pe.displayName=q;var qe="RadioBubbleInput",xe=l.forwardRef(({__scopeSlider:e,value:t,...n},o)=>{const i=l.useRef(null),c=D(i,o),s=Ke(t);return l.useEffect(()=>{const a=i.current;if(!a)return;const f=window.HTMLInputElement.prototype,m=Object.getOwnPropertyDescriptor(f,"value").set;if(s!==t&&m){const r=new Event("input",{bubbles:!0});m.call(a,t),a.dispatchEvent(r)}},[s,t]),d.jsx(V.input,{style:{display:"none"},...n,ref:c,defaultValue:t})});xe.displayName=qe;function Xe(e=[],t,n){const o=[...e];return o[n]=t,o.sort((i,c)=>i-c)}function be(e,t,n){const c=100/(n-t)*(e-t);return se(c,[0,100])}function Je(e,t){return t>2?`Value ${e+1} of ${t}`:t===2?["Minimum","Maximum"][e]:void 0}function Qe(e,t){if(e.length===1)return 0;const n=e.map(i=>Math.abs(i-t)),o=Math.min(...n);return n.indexOf(o)}function Ze(e,t,n){const o=e/2,c=Q([0,50],[0,o]);return(o-c(t)*n)*n}function et(e){return e.slice(0,-1).map((t,n)=>e[n+1]-t)}function tt(e,t){if(t>0){const n=et(e);return Math.min(...n)>=t}return!0}function Q(e,t){return n=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const o=(t[1]-t[0])/(e[1]-e[0]);return t[0]+o*(n-e[0])}}function nt(e){return(String(e).split(".")[1]||"").length}function ot(e,t){const n=Math.pow(10,t);return Math.round(e*n)/n}var rt=de,st=he,at=ge,it=pe;const X=l.forwardRef(({className:e,...t},n)=>d.jsxs(rt,{ref:n,className:F("relative flex w-full touch-none select-none items-center",t.disabled&&"opacity-50",e),...t,children:[d.jsx(st,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-muted",children:d.jsx(at,{className:"absolute h-full bg-primary"})}),d.jsx(it,{className:"block h-5 w-5 rounded-full border border-border bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"})]}));X.displayName="Slider";const gt=({preference:e,isReady:t,onVolumeChange:n,soundPreference:o,onSoundVolumeChange:i,showSoundSlider:c=!0,className:s})=>{const[a,f]=l.useState(!1),g=l.useRef(null);return l.useEffect(()=>{if(!a)return;const m=r=>{const u=r.target;u instanceof Node&&(g.current?.contains(u)||f(!1))};return document.addEventListener("pointerdown",m),()=>{document.removeEventListener("pointerdown",m)}},[a]),d.jsxs("div",{ref:g,className:F("relative flex items-center",s),children:[d.jsx(Oe,{enabled:e.volume>0,onToggle:()=>f(m=>!m),disabled:!t}),d.jsx("div",{className:F("overflow-hidden transition-[width,opacity,margin] duration-200 ease-out",a?"ml-2 w-52 opacity-100":"ml-0 w-0 opacity-0"),"aria-hidden":!a,children:d.jsxs("div",{className:"flex flex-col gap-2 text-xs",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"w-8 text-right",children:"BGM"}),d.jsx(X,{value:[Math.round(e.volume*100)],min:0,max:100,step:1,disabled:!t,onValueChange:m=>{const r=Math.min(100,Math.max(0,m[0]??0))/100;n(r)}})]}),c&&o&&i?d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"w-8 text-right",children:"SE"}),d.jsx(X,{value:[Math.round(o.volume*100)],min:0,max:100,step:1,disabled:!t,onValueChange:m=>{const r=Math.min(100,Math.max(0,m[0]??0))/100;i(r)}})]}):null]})})]})};export{gt as B,mt as a,St as b,ht as h,ke as p,ft as r,ut as s,dt as u};
