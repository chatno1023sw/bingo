import{j as e,w as V,r as s,u as D}from"./chunk-JMJ3UQ3L-CakUOnqu.js";import{B as c,C as K,j as U,s as j}from"./CommonDialog-Dfx684_S.js";import{u as S,h as v,B as q,s as C,a as G,b as L,r as H}from"./BgmControl-Ch9JafY7.js";const I=({onStart:i,onResumeRequest:o,onNavigateSetting:a,isSubmitting:r=!1,canResume:n=!0})=>e.jsxs("section",{className:"flex flex-col items-center justify-center gap-15",children:[e.jsx("h1",{className:"text-5xl text-foreground tracking-wide",children:"BINGOゲーム"}),e.jsxs("div",{className:"flex w-48 flex-col gap-4",children:[e.jsx(c,{type:"button",className:"rounded-full bg-primary px-6 py-2 text-base text-primary-foreground shadow-sm hover:bg-primary",onClick:i,disabled:r,children:"はじめから"}),n?e.jsx(c,{type:"button",className:"rounded-full bg-primary px-6 py-2 text-base text-primary-foreground shadow-sm hover:bg-primary",onClick:o,disabled:r,children:"続きから"}):null,e.jsx(c,{type:"button",className:"rounded-full bg-secondary px-6 py-2 text-base text-secondary-foreground shadow-sm hover:bg-secondary/80",onClick:a,disabled:r,children:"設定"})]}),e.jsx("div",{className:"absolute right-6 bottom-6 text-muted-foreground text-xl",children:e.jsx("span",{children:"SE ・ BGM: 魔王魂"})})]}),M=({open:i,title:o="最初から始める？",description:a="前回の抽選結果を忘れて再スタート！",onClose:r,onConfirm:n,disabled:l=!1})=>e.jsx(K,{open:i,onClose:r,title:o,description:a,showCloseButton:!0,closeDisabled:l,footer:e.jsxs(e.Fragment,{children:[e.jsx(c,{type:"button",className:"flex-1 rounded-2xl px-4 py-3",onClick:r,disabled:l,children:"キャンセル"}),e.jsx(c,{type:"button",variant:"outline",className:"flex-1 rounded-2xl px-4 py-3",onClick:n,disabled:l,children:"OK"})]})}),$=V(function(){const[o,a]=s.useState(!1),[r,n]=s.useState(!1),[l,R]=s.useState(!1),d=s.useRef(null),u=s.useRef(!1),x=s.useRef(!1),g=s.useRef(!1),p=D(),{preference:m,isReady:w,setVolume:N}=S({storageKey:j.bgmStart,defaultVolume:.1}),{preference:k,setVolume:B}=S({storageKey:j.se,defaultVolume:.2}),h=async()=>{n(!0);try{await C(),n(!1),p("/game")}catch{n(!1)}},E=()=>{if(!r){if(v()||G()||L()){a(!0);return}h()}},O=async()=>{n(!0);try{await H()||await C(),n(!1),p("/game")}catch{n(!1)}},P=()=>{p("/setting")};s.useEffect(()=>{R(v())},[]);const f=s.useCallback(()=>{const t=d.current;t&&(t.play(),u.current=!0)},[]),y=s.useCallback(()=>{x.current&&(x.current=!1,g.current=!1,f())},[f]),b=s.useCallback(()=>{if(g.current)return;g.current=!0;const t=()=>y();document.addEventListener("pointerdown",t,{once:!0}),document.addEventListener("keydown",t,{once:!0})},[y]);return s.useEffect(()=>{const t=new U.Howl({src:["./start-bgm.mp3"],loop:!0,preload:!0,onplayerror:()=>{x.current=!0,u.current=!1,b()}});return d.current=t,()=>{t.stop(),t.unload(),d.current=null}},[b]),s.useEffect(()=>{const t=d.current;if(t){if(t.volume(m.volume),m.volume>0){u.current||f();return}u.current&&(t.stop(),u.current=!1)}},[m.volume,f]),e.jsxs("main",{className:"flex min-h-screen items-center justify-center bg-background px-6 py-10 text-foreground",children:[e.jsx("div",{className:"absolute top-8 right-8",children:e.jsx(q,{preference:m,soundPreference:k,isReady:w,onVolumeChange:N,onSoundVolumeChange:B})}),e.jsx("div",{className:"flex min-h-90 items-center justify-center",children:e.jsx(I,{onStart:E,onResumeRequest:()=>{O()},onNavigateSetting:P,isSubmitting:r,canResume:l})}),e.jsx(M,{open:o,onClose:()=>a(!1),onConfirm:()=>{a(!1),h()},disabled:r})]})});export{$ as default};
