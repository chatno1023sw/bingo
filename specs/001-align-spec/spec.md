# Feature Specification: Bingo抽選アプリ仕様整備

**Feature Branch**: `[001-align-spec]`  
**Created**: 2025-11-16  
**Status**: Draft  
**Input**: User description: "docsに入っているspec seedは私が作った要件定義や画面のレイアウトです。そしてspec by kiroはそのspec seedをAWS Kiroが仕様書駆動開発に則って作成した要件定義やtasksになります。これらを参考に作成してください"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 司会者がゲームを開始・再開できる (Priority: P1)

司会者としてアプリを起動し、「はじめから」「続きから」「設定」から目的の操作を迷いなく選べる。

**Why this priority**: ゲーム開始ができなければ全体の進行が止まるため、最も重要な価値提供となる。

**Independent Test**: Start 画面の 3 ボタンと保存状態の有無を切り替えるだけで、単体での価値確認が完結する。

**Acceptance Scenarios**:

1. **Given** アプリ初回起動時, **When** Start 画面で「はじめから」を押す, **Then** 進行状態が初期化され `/game` へ遷移する。
2. **Given** 保存済み状態が localStorage に存在する, **When** 「続きから」を押す, **Then** 保存内容が読み込まれた状態で `/game` に遷移する。
3. **Given** 保存済み状態が存在しない, **When** 「続きから」を押す, **Then** 新規ゲーム開始を知らせたうえで初期状態の `/game` へ遷移する。
4. **Given** Start 画面, **When** 「設定」ボタンを押す, **Then** `/setting` に遷移し戻り操作も案内される。

---

### User Story 2 - BGM を場面に応じて制御する (Priority: P2)

司会者として会場の雰囲気に合わせ BGM を即時にオン／オフし、設定が次回以降にも維持されるようにしたい。

**Why this priority**: 音声演出はイベント体験を左右し、会場側の事情で素早く止める必要があるため。

**Independent Test**: Start 画面右上のトグルのみを操作し、音声変化と状態保存を確認すれば完結に検証できる。

**Acceptance Scenarios**:

1. **Given** Start 画面, **When** 右上の BGM トグルを切り替える, **Then** 音声が即時で停止または再生しアイコンも同期する。
2. **Given** 直前に BGM をオフへ設定, **When** アプリを再読み込みする, **Then** BGM は無効なまま起動し状態も表示される。

---

### User Story 3 - 抽選と履歴提示を正しく運用する (Priority: P1)

司会者として抽選ボタンひとつで被りのないビンゴ番号を決定し、現在の番号と直近履歴・全履歴を参加者へ示したい。

**Why this priority**: 抽選の信頼性と透明性がイベント成功に直結するため。

**Independent Test**: Game 画面のみで抽選ボタン→履歴表示→全履歴モーダルの流れを繰り返せば価値検証が完結する。

**Acceptance Scenarios**:

1. **Given** 未抽選番号が残っている, **When** 抽選ボタンを押して演出が止まる, **Then** 新番号が中央へ強調表示され履歴にも追加される。
2. **Given** 抽選履歴が 10 件以上ある, **When** 新たに抽選する, **Then** 左ペインには最新 10 件のみが表示され古い番号はモーダルで確認できる。
3. **Given** 左ペイン下部の案内, **When** 「これまでの当選番号を見る」を押す, **Then** 全履歴モーダルが開閉でき全番号が閲覧できる。

---

### User Story 4 - 景品の配布状況を一元管理する (Priority: P1)

司会者として抽選結果に合わせて景品ステータスを切り替え、画像や賞名つきで進行を共有し、誤操作時もすぐ修正したい。

**Why this priority**: 景品管理が混乱すると進行が滞り参加者満足度が低下するため、抽選と同じ重要度となる。

**Independent Test**: Game 画面右ペインだけを操作し、景品表示・当選/戻す・視覚表現を検証することで独立して価値を確認できる。

**Acceptance Scenarios**:

1. **Given** Game 画面右ペイン, **When** 任意の景品で「当選」を押す, **Then** 行に取消線やステータス更新が反映され保存される。
2. **Given** 景品が当選済み, **When** 「戻す」を押す, **Then** 取消線が外れ次回表示でも未選出として扱われる。

---

### User Story 5 - 景品マスタを柔軟に編集できる (Priority: P2)

景品担当者として Setting 画面で CSV 管理を前提に景品を一括登録・並び替え・削除し、本番用リストを整えたい。

**Why this priority**: 景品構成は毎回異なるため、担当者が自走で更新できる仕組みが運用上不可欠。

**Independent Test**: Setting 画面だけで CSV 取り込み→行編集→並び替え→一括削除の操作を行い、Game 画面へ反映されるか確認すれば完結に検証できる。

**Acceptance Scenarios**:

1. **Given** Setting 画面, **When** CSV を取り込む, **Then** カラム定義どおりに景品行が追加され即座に編集できる。
2. **Given** 複数の景品が表示される, **When** DnD で行を入れ替える, **Then** 新しい順序が保存され Game 画面でも同じ並びになる。
3. **Given** 誤った景品リスト, **When** 一括削除を実行し確認ダイアログで承認する, **Then** 全景品が削除され保存領域からも消える。

---

### Edge Cases

- 保存済みゲーム状態が存在しないのに「続きから」を押した場合は、新規ゲーム開始可否を明示し初期化する。
- 全てのビンゴ番号を抽選し終えた場合は、抽選ボタンを無効化し「抽選済みです」と伝える。
- 抽選中に画面をリロードしても、直前に確定した番号と履歴が再現される。
- CSV 取り込みで必須カラムが欠ける、または重複 ID が含まれる場合は取り込みを中止しエラー内容を一覧表示する。
- 景品画像パスが無効な場合は、代替テキストまたは汎用サムネイルを表示して進行を止めない。
- localStorage 保存が失敗した際は最新の確定状態を保持し、「保存できませんでした」と通知する。

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムは起動直後に Start 画面を表示し、「はじめから」「続きから」「設定」の 3 アクションを提示すること。
- **FR-002**: 「はじめから」選択時は抽選履歴・景品当選状態・BGM 設定を初期化したうえで Game 画面へ遷移すること。
- **FR-003**: 「続きから」選択時は localStorage に保存されたゲーム状態を読み込み、存在しない場合は初期化した旨を通知すること。
- **FR-004**: Start 画面から設定画面へ遷移でき、戻る操作やパンくずを表示して Start へ戻れるようにすること。
- **FR-005**: Start 画面右上に BGM トグルアイコンを表示し、切替と同時に音声・アイコン双方が連動すること。
- **FR-006**: BGM のオン／オフ状態は localStorage へ即時保存され、次回起動時に自動復元されること。
- **FR-007**: Game 画面の抽選ボタンは未抽選番号からランダムに 1 つを選び、同じ番号を再表示しないこと。
- **FR-008**: 抽選中はボタンのラベルや無効状態で進行状況を示し、結果確定までは再抽選を受け付けないこと。
- **FR-009**: 当選番号は中央エリアで視覚的に強調表示され、確定時に localStorage の履歴へ即時追記されること。
- **FR-010**: 左ペインに直近 10 件の当選番号を新しい順で表示し、10 件を超えた分は全履歴モーダルで閲覧可能にすること。
- **FR-011**: 「これまでの当選番号を見る」リンクを押すと全履歴モーダルが開き、全件をスクロールで確認できること。
- **FR-012**: Game 画面右ペインには賞名・商品名または画像・当選ステータスを行単位で表示し、視認性を確保すること。
- **FR-013**: 景品行には当選/戻す操作を用意し、当選済みは取消線やバッジで視覚化して localStorage に保存すること。
- **FR-014**: Setting 画面では Grid もしくは Flex で表現した景品リストを提供し、各行に賞名・商品名/画像・当選状態・削除操作を含めること。
- **FR-015**: Setting 画面で DnD による行の並び替えを提供し、順序変更は保存され Game 画面の表示へ反映されること。
- **FR-016**: CSV 取り込みにより複数景品を一括追加でき、必須カラム欠落や不正値は追加せずエラーを通知すること。
- **FR-017**: 景品データは CSV としてエクスポート可能で、共有時には個人情報を含まないダミーに差し替える運用手順を案内すること。
- **FR-018**: Setting 画面の一括削除操作では確認ダイアログを表示し、承認後に全景品と保存状態を完全に削除すること。
- **FR-019**: ゲーム状態（抽選済み番号、景品当選状態、BGM 設定）は変更ごとにブラウザローカルへ保存し、再起動後も復元されること。
- **FR-020**: アプリはネットワーク遮断中でも全機能が動作し、外部 API やオンラインファイルに依存しないこと。
- **FR-021**: 画面デザインは docs/spec seed/design に沿い、プロジェクタ表示でも視認できる配色・余白・タイポグラフィを守ること。

### Key Entities *(include if feature involves data)*

- **GameState**: 現在の抽選番号、抽選済み番号リスト、抽選進行フラグをまとめた状態集合。Start 画面で初期化・読込を制御する。
- **DrawHistoryEntry**: 単一抽選の結果（番号、抽選時刻、順番）を表す行で、左ペインと全履歴モーダル双方の表示源となる。
- **Prize**: 賞 ID、表示順、賞名、商品名/画像、当選状態を持つ景品レコード。Game 右ペインと Setting 画面の双方で参照・更新される。
- **BGMPreference**: BGM のオン/オフ状態および音量指標を保持する単独設定。Start 画面のトグル操作で更新される。
- **CSVImportJob**: CSV 取り込み要求の文脈（ファイル名、検証結果、追加件数、エラー要約）を表し、取り込み成否の通知に使用する。

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: アプリ起動から新規ゲーム開始または続き再開までの操作を 5 秒以内に完了できる利用者が 95% 以上となる。
- **SC-002**: 抽選ボタン押下から結果確定表示までの体感時間が 3 秒以内であることを 20 回連続抽選テストで確認する。
- **SC-003**: 抽選 100 回で重複番号が 0 件であることと、全番号が履歴モーダルに記録されていることを QA で証明する。
- **SC-004**: 景品 CSV からの一括更新後に Game 画面へ反映されるまで 30 秒以内で完了し、担当者アンケートで 90% 以上が「操作が簡単」と回答する。
- **SC-005**: ブラウザを閉じて再度開いた際、直前の抽選結果・景品状態・BGM 設定が 100% 復元されることを 3 回の再現テストで確認する。

## Assumptions & Dependencies

- 進行役は単独で Start/Game/Setting を操作し、画面はプロジェクタで共有される。
- BGM や画像などのメディアは `public/` 配下に事前配置され、オフラインでも読み込める。
- Chrome 最新版での動作を前提とし、localStorage に十分な空き容量がある。
- CSV の編集や差し替えはイベント前に担当者が行い、本番中は Setting 画面で軽微な調整のみを行う。
